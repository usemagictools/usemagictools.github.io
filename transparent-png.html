<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CT8E5N460D"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-CT8E5N460D');</script>
    <title>Transparent PNG Maker - Free Online Color Remover | No Ads, No Signup</title>

    <!-- SEO Meta -->
    <meta name="description" content="Remove any color from images to create transparent PNGs instantly. Multi-color removal, real-time preview, edge smoothing. ‚úÖ No ads ‚úÖ No signup ‚úÖ No limits. Runs entirely in your browser.">
    <meta name="keywords" content="transparent png maker, remove background color, color to transparent, png transparency, make image transparent, remove color from image, no ads, no signup, no login, no watermark, free unlimited, browser-based, no installation, local processing">
    <meta name="author" content="UseMagicTools">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="bingbot" content="index, follow">
    <meta name="revisit-after" content="7 days">
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <meta name="language" content="en">
    <link rel="canonical" href="https://www.usemagictools.com/transparent-png.html">
    <link rel="alternate" hreflang="en" href="https://www.usemagictools.com/transparent-png.html">
    <link rel="alternate" hreflang="zh-CN" href="https://www.usemagictools.com/transparent-png.html">
    <link rel="alternate" hreflang="fr" href="https://www.usemagictools.com/transparent-png.html">
    <link rel="alternate" hreflang="es" href="https://www.usemagictools.com/transparent-png.html">
    <link rel="alternate" hreflang="x-default" href="https://www.usemagictools.com/transparent-png.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.usemagictools.com/transparent-png.html">
    <meta property="og:title" content="Transparent PNG Maker - Free Online Color Remover | No Ads, No Signup">
    <meta property="og:description" content="Remove any color from images to create transparent PNGs instantly. Multi-color removal, real-time preview, edge smoothing. 100% free, no ads.">
    <meta property="og:image" content="https://www.usemagictools.com/screenshots/transparent-png-v1.webp">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="zh_CN">
    <meta property="og:site_name" content="Web Toolbox">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@usemagictools">
    <meta name="twitter:creator" content="@usemagictools">
    <meta name="twitter:title" content="Transparent PNG Maker - Free Online Color Remover | No Ads, No Signup">
    <meta name="twitter:description" content="Remove any color from images to create transparent PNGs instantly. Multi-color removal, real-time preview, edge smoothing.">
    <meta name="twitter:image" content="https://www.usemagictools.com/screenshots/transparent-png-v1.webp">

    <!-- JSON-LD: WebApplication -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Transparent PNG Maker",
        "alternateName": ["ÈÄèÊòéPNGÁîüÊàêÂô®", "Color to Transparent PNG", "PNG Transparency Creator", "Remove Color from Image"],
        "url": "https://www.usemagictools.com/transparent-png.html",
        "description": "Remove any color from images to create transparent PNGs instantly with multi-color removal, real-time preview, and edge smoothing.",
        "inLanguage": ["en", "zh-CN", "fr", "es"],
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Web Browser",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
        "author": { "@type": "Person", "name": "UseMagicTools" },
        "publisher": { "@type": "Organization", "name": "Web Toolbox", "url": "https://www.usemagictools.com/" },
        "featureList": ["Multi-color removal", "Real-time before/after preview", "Edge smoothing", "Match outer pixels only", "Custom background preview", "Undo/Redo support", "No ads", "No signup required", "No watermark", "100% browser-based", "Unlimited usage"],
        "screenshot": "https://www.usemagictools.com/screenshots/transparent-png-v1.webp"
    }
    </script>

    <!-- JSON-LD: BreadcrumbList -->
    <script type="application/ld+json">
    {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://www.usemagictools.com/"
        },
        {
            "@type": "ListItem",
            "position": 2,
            "name": "Transparent PNG Maker",
            "item": "https://www.usemagictools.com/transparent-png.html"
        }
    ]
}
    </script>

    <!-- JSON-LD: HowTo -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "HowTo",
        "name": "How to Create Transparent PNG",
        "totalTime": "PT1M",
        "step": [
            { "@type": "HowToStep", "position": 1, "name": "Upload Image", "text": "Drag and drop, click to upload, or paste (Ctrl+V) any image file (PNG, JPG, WebP)." },
            { "@type": "HowToStep", "position": 2, "name": "Pick Colors to Remove", "text": "Click on the image to select colors you want to make transparent. Adjust tolerance and edge smoothing as needed." },
            { "@type": "HowToStep", "position": 3, "name": "Download Transparent PNG", "text": "Preview the result with the before/after slider, then download your transparent PNG." }
        ]
    }
    </script>

    <!-- JSON-LD: FAQPage -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            { "@type": "Question", "name": "What is a transparent PNG and why do I need one?", "acceptedAnswer": { "@type": "Answer", "text": "A transparent PNG is an image where certain areas have been made see-through (transparent), allowing the background behind it to show through. This is essential for logos, product photos, web design elements, and any image that needs to be placed on different backgrounds without a visible rectangular border. Unlike JPG, the PNG format supports an alpha channel that stores transparency information for each pixel." } },
            { "@type": "Question", "name": "How does color tolerance work?", "acceptedAnswer": { "@type": "Answer", "text": "Color tolerance determines how closely a pixel must match your selected color to be made transparent. At 0% tolerance, only exact color matches are removed. At higher tolerance (e.g., 30%), similar shades and tones are also removed. This is useful for photos where backgrounds have slight color variations due to lighting, shadows, or compression artifacts." } },
            { "@type": "Question", "name": "What does Match Outer Pixels Only do?", "acceptedAnswer": { "@type": "Answer", "text": "When enabled, Match Outer Pixels Only removes the selected color only from areas connected to the image edges (like a flood-fill from the borders). This preserves interior areas that happen to match the color. For example, if you are removing a white background from a product photo, interior white areas within the product will be preserved." } },
            { "@type": "Question", "name": "Can I remove multiple colors at once?", "acceptedAnswer": { "@type": "Answer", "text": "Yes! You can click on multiple areas of the image to pick different colors. Each color is added as a chip that you can individually remove. All selected colors are processed simultaneously, making it easy to handle complex backgrounds with gradients or multiple tones." } },
            { "@type": "Question", "name": "What does edge smoothing do?", "acceptedAnswer": { "@type": "Answer", "text": "Edge smoothing creates a gradual transition between transparent and opaque areas instead of a hard cutoff. This produces more natural-looking results, especially when the transparent image is placed on a new background. Without smoothing, edges can appear jagged or have visible halos." } },
            { "@type": "Question", "name": "Is this tool really free with no ads?", "acceptedAnswer": { "@type": "Answer", "text": "Yes, 100% free with no ads, no registration, no watermark, and no usage limits. All image processing happens locally in your browser using Canvas API ‚Äî your images are never uploaded to any server. There are no premium plans or hidden restrictions." } }
        ]
    }
    </script>

    <link rel="stylesheet" href="common/common.css">

    <style>
        /* ========== Reset & Base ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px; }

        /* ========== Page Header ========== */
        .page-header { text-align: center; margin-bottom: 32px; }
        .page-header h1 {
            font-size: 32px; font-weight: 700; color: #fff;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #a78bfa, #7c3aed, #6d28d9);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .page-header .subtitle { color: #9ca3af; font-size: 16px; line-height: 1.5; }

        /* ========== Upload Zone ========== */
        .upload-zone {
            position: relative;
            border: 2px dashed rgba(124, 58, 237, 0.4);
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(124, 58, 237, 0.05);
            overflow: hidden;
        }
        .upload-zone::before {
            content: '';
            position: absolute; inset: -2px;
            border-radius: 22px;
            background: conic-gradient(from 0deg, #7c3aed, #a78bfa, #c084fc, #7c3aed);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.4s;
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: transparent;
            background: rgba(124, 58, 237, 0.1);
            transform: scale(1.01);
        }
        .upload-zone:hover::before, .upload-zone.dragover::before {
            opacity: 1;
            animation: borderSpin 4s linear infinite;
        }
        @keyframes borderSpin {
            to { transform: rotate(360deg); }
        }
        .upload-zone .upload-icon {
            font-size: 56px; margin-bottom: 16px;
            animation: floatUp 3s ease-in-out infinite;
        }
        @keyframes floatUp {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .upload-zone h2 { color: #fff; font-size: 22px; margin-bottom: 8px; }
        .upload-zone p { color: #9ca3af; font-size: 14px; margin-bottom: 4px; }
        .upload-zone .paste-hint {
            display: inline-block; margin-top: 12px;
            padding: 6px 14px; border-radius: 8px;
            background: rgba(124, 58, 237, 0.15);
            color: #a78bfa; font-size: 13px;
        }
        .upload-zone input[type="file"] { display: none; }

        /* ========== Workspace ========== */
        .workspace { display: none; animation: fadeSlideIn 0.5s ease; }
        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Toolbar */
        .toolbar {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 16px; flex-wrap: wrap; gap: 8px;
        }
        .toolbar-group { display: flex; gap: 6px; align-items: center; }
        .tool-btn {
            display: inline-flex; align-items: center; justify-content: center;
            width: 36px; height: 36px; border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.3); color: #e0e0e0;
            cursor: pointer; font-size: 16px;
            transition: all 0.2s;
        }
        .tool-btn:hover { background: rgba(124,58,237,0.2); border-color: rgba(124,58,237,0.4); }
        .tool-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .tool-btn:disabled:hover { background: rgba(0,0,0,0.3); border-color: rgba(255,255,255,0.1); }
        .tool-btn-text {
            width: auto; padding: 0 14px; font-size: 13px; gap: 6px;
            font-family: inherit;
        }

        /* Canvas Area */
        .canvas-area {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.08);
            margin-bottom: 20px;
            min-height: 200px;
        }
        .canvas-wrapper {
            display: flex; align-items: center; justify-content: center;
            overflow: auto;
            max-height: 560px;
        }
        .canvas-inner { position: relative; display: inline-block; line-height: 0; }
        #mainCanvas { display: block; cursor: crosshair; }

        /* Comparison Slider */
        .slider-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
        }
        .slider-line {
            position: absolute; top: 0; bottom: 0;
            width: 3px;
            background: #fff;
            transform: translateX(-50%);
            box-shadow: 0 0 8px rgba(0,0,0,0.5);
            pointer-events: none;
            /* Wider invisible hit area for easier grabbing */
        }
        .slider-line::before {
            content: '';
            position: absolute; top: 0; bottom: 0;
            left: -12px; width: 27px;
            cursor: ew-resize;
            pointer-events: all;
        }
        .slider-handle {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 36px; height: 36px;
            border-radius: 50%;
            background: #fff;
            border: 2px solid rgba(124,58,237,0.6);
            display: flex; align-items: center; justify-content: center;
            cursor: ew-resize;
            pointer-events: all;
            box-shadow: 0 2px 12px rgba(0,0,0,0.4);
            font-size: 14px; color: #7c3aed; font-weight: 700;
            user-select: none;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .slider-handle:hover {
            transform: translate(-50%, -50%) scale(1.15);
            box-shadow: 0 4px 20px rgba(124,58,237,0.4);
        }
        .slider-label {
            position: absolute; top: 12px;
            padding: 4px 10px; border-radius: 6px;
            background: rgba(0,0,0,0.65);
            color: #fff; font-size: 12px; font-weight: 500;
            pointer-events: none;
            backdrop-filter: blur(4px);
        }
        .slider-label-left { left: 12px; }
        .slider-label-right { right: 12px; }

        /* Color Cursor Tooltip */
        .color-cursor {
            position: absolute;
            pointer-events: none;
            background: rgba(0,0,0,0.85);
            border-radius: 8px;
            padding: 5px 10px;
            display: flex; align-items: center; gap: 8px;
            font-size: 12px; color: #fff;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.15);
            transform: translate(16px, -50%);
            white-space: nowrap;
            z-index: 10;
            transition: opacity 0.15s;
        }
        .cursor-swatch {
            width: 18px; height: 18px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            flex-shrink: 0;
        }

        /* Pick Hint Overlay */
        .pick-hint {
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 12px 24px; border-radius: 12px;
            background: rgba(0,0,0,0.7);
            color: #fff; font-size: 14px; font-weight: 500;
            pointer-events: none;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(124,58,237,0.3);
            animation: pulseFade 2.5s ease-in-out infinite;
        }
        @keyframes pulseFade {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.5; }
        }

        /* ========== Control Panel ========== */
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .control-card {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px;
            padding: 18px;
        }
        .control-card h3 {
            font-size: 13px; font-weight: 600;
            color: #a78bfa; margin-bottom: 12px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* Color Chips */
        .color-chips {
            display: flex; flex-wrap: wrap; gap: 8px;
            margin-bottom: 12px; min-height: 32px;
        }
        .color-chip {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 4px 10px 4px 6px;
            border-radius: 20px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
            font-size: 12px; color: #e0e0e0;
            animation: chipPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes chipPop {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .chip-swatch {
            width: 20px; height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            flex-shrink: 0;
        }
        .chip-remove {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none; color: #9ca3af;
            cursor: pointer; font-size: 12px; line-height: 1;
            transition: all 0.2s;
        }
        .chip-remove:hover { background: rgba(239,68,68,0.3); color: #ef4444; }
        .color-empty { color: #6b7280; font-size: 13px; font-style: italic; }

        .color-add-row {
            display: flex; gap: 8px; align-items: center;
        }
        .color-add-row input[type="color"] {
            width: 36px; height: 32px; border: none;
            border-radius: 8px; cursor: pointer;
            background: transparent;
        }
        .color-add-row input[type="color"]::-webkit-color-swatch-wrapper { padding: 2px; }
        .color-add-row input[type="color"]::-webkit-color-swatch {
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 6px;
        }
        .btn-add-color {
            padding: 6px 14px; border-radius: 8px;
            border: 1px solid rgba(124,58,237,0.4);
            background: rgba(124,58,237,0.15);
            color: #a78bfa; font-size: 13px;
            cursor: pointer; transition: all 0.2s;
            font-family: inherit;
        }
        .btn-add-color:hover { background: rgba(124,58,237,0.3); }

        /* Settings Card */
        .settings-row { margin-bottom: 14px; }
        .settings-row:last-child { margin-bottom: 0; }
        .settings-row label {
            display: block; font-size: 13px; color: #d1d5db;
            margin-bottom: 6px;
        }
        .range-row { display: flex; align-items: center; gap: 12px; }
        .range-row input[type="range"] { flex: 1; }
        .range-value {
            min-width: 42px; text-align: center;
            font-size: 13px; color: #a78bfa; font-weight: 600;
            background: rgba(124,58,237,0.12);
            padding: 3px 8px; border-radius: 6px;
        }

        /* Custom Range Slider */
        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            height: 6px; border-radius: 3px;
            background: rgba(255,255,255,0.1);
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px; height: 20px; border-radius: 50%;
            background: #7c3aed; border: 2px solid #a78bfa;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(124,58,237,0.4);
            transition: transform 0.15s;
        }
        input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; border-radius: 50%;
            background: #7c3aed; border: 2px solid #a78bfa;
            cursor: pointer;
        }

        /* Checkboxes */
        .checkbox-row {
            display: flex; align-items: center; gap: 8px;
            margin-bottom: 10px; cursor: pointer;
        }
        .checkbox-row:last-child { margin-bottom: 0; }
        .checkbox-row input[type="checkbox"] {
            width: 18px; height: 18px; border-radius: 4px;
            accent-color: #7c3aed; cursor: pointer;
        }
        .checkbox-row span { font-size: 13px; color: #d1d5db; }
        .checkbox-desc { font-size: 11px; color: #6b7280; margin-left: 26px; margin-top: -6px; }

        /* Background Options */
        .bg-options { display: flex; gap: 8px; }
        .bg-btn {
            width: 40px; height: 40px; border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.3);
            cursor: pointer; font-size: 18px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
            color: #e0e0e0;
        }
        .bg-btn:hover { border-color: rgba(124,58,237,0.4); }
        .bg-btn.active { border-color: #7c3aed; background: rgba(124,58,237,0.2); }
        .bg-btn-checker {
            background-image:
                linear-gradient(45deg, #666 25%, transparent 25%),
                linear-gradient(-45deg, #666 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #666 75%),
                linear-gradient(-45deg, transparent 75%, #666 75%);
            background-size: 10px 10px;
            background-position: 0 0, 0 5px, 5px -5px, -5px 0;
        }
        .bg-btn-white { background: #fff !important; }
        .bg-btn-black { background: #111 !important; }
        .bg-btn-custom { position: relative; overflow: hidden; }
        .bg-btn-custom input[type="color"] {
            position: absolute; inset: 0;
            width: 100%; height: 100%;
            opacity: 0; cursor: pointer;
        }

        /* Download Section */
        .download-section { grid-column: 1 / -1; }
        .download-btn {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; padding: 16px;
            border-radius: 14px; border: none;
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: #fff; font-size: 16px; font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            box-shadow: 0 4px 20px rgba(124,58,237,0.3);
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(124,58,237,0.5);
        }
        .download-btn:disabled {
            opacity: 0.4; cursor: not-allowed;
            transform: none; box-shadow: none;
        }

        /* Processing overlay */
        .processing-overlay {
            position: absolute; inset: 0;
            display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(2px);
            z-index: 20; border-radius: 16px;
        }
        .processing-spinner {
            width: 36px; height: 36px;
            border: 3px solid rgba(124,58,237,0.2);
            border-top-color: #7c3aed;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Toast notification */
        .toast {
            position: fixed; bottom: 24px; left: 50%;
            transform: translateX(-50%) translateY(80px);
            padding: 10px 20px; border-radius: 10px;
            background: rgba(0,0,0,0.85);
            color: #fff; font-size: 14px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s;
            opacity: 0; pointer-events: none;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        /* ========== Trust Bar ========== */
        /* Uses common.css .trust-bar / .trust-item */

        /* ========== Features ========== */
        .features-section { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
        .features-section h2 { text-align: center; font-size: 24px; margin-bottom: 24px; color: #fff; }
        .features-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .feature-card {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 24px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .feature-card:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(124,58,237,0.3); }
        .feature-card .icon { font-size: 32px; margin-bottom: 12px; }
        .feature-card h3 { color: #a78bfa; margin-bottom: 8px; font-size: 16px; }
        .feature-card p { color: #9ca3af; font-size: 14px; line-height: 1.5; }

        /* ========== FAQ ========== */
        .faq-section { max-width: 800px; margin: 40px auto; padding: 0 20px; }
        .faq-section h2 { text-align: center; font-size: 24px; margin-bottom: 24px; color: #fff; }
        .faq-item {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; margin-bottom: 12px; overflow: hidden;
        }
        .faq-question {
            width: 100%; background: none; border: none;
            padding: 16px 20px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 500; color: #e0e0e0; font-size: inherit;
            font-family: inherit;
        }
        .faq-question:hover { background: rgba(124,58,237,0.1); }
        .faq-question .arrow { transition: transform 0.3s; font-size: 14px; color: #7c3aed; }
        .faq-item.active .faq-question .arrow { transform: rotate(180deg); }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .faq-item.active .faq-answer { max-height: 300px; }
        .faq-answer p { padding: 0 20px 16px; color: #9ca3af; font-size: 14px; line-height: 1.6; }

        /* ========== Light Theme ========== */
        body[data-theme="light"] { background: #fafafa !important; color: #09090b; }
        [data-theme="light"] .page-header h1 { -webkit-text-fill-color: #09090b; background: none; }
        [data-theme="light"] .page-header .subtitle { color: #71717a; }
        [data-theme="light"] .upload-zone { background: rgba(124,58,237,0.03); border-color: rgba(124,58,237,0.25); }
        [data-theme="light"] .upload-zone h2 { color: #09090b; }
        [data-theme="light"] .upload-zone p { color: #71717a; }
        [data-theme="light"] .tool-btn { background: #fff; border-color: #e4e4e7; color: #09090b; }
        [data-theme="light"] .tool-btn:hover { background: rgba(124,58,237,0.06); border-color: rgba(124,58,237,0.3); }
        [data-theme="light"] .canvas-area { background: #f4f4f5; border-color: #e4e4e7; }
        [data-theme="light"] .control-card { background: #fff; border-color: #e4e4e7; }
        [data-theme="light"] .control-card h3 { color: #7c3aed; }
        [data-theme="light"] .color-chip { background: rgba(0,0,0,0.04); border-color: #e4e4e7; color: #09090b; }
        [data-theme="light"] .settings-row label { color: #374151; }
        [data-theme="light"] .range-value { background: rgba(124,58,237,0.08); }
        [data-theme="light"] .checkbox-row span { color: #374151; }
        [data-theme="light"] input[type="range"] { background: #e4e4e7; }
        [data-theme="light"] .bg-btn { background: #f4f4f5; border-color: #e4e4e7; color: #09090b; }
        [data-theme="light"] .pick-hint { background: rgba(255,255,255,0.9); color: #09090b; border-color: rgba(124,58,237,0.2); }
        [data-theme="light"] .color-cursor { background: rgba(255,255,255,0.95); color: #09090b; border-color: #e4e4e7; }
        [data-theme="light"] .toast { background: rgba(255,255,255,0.95); color: #09090b; border-color: #e4e4e7; }
        [data-theme="light"] .features-section h2 { color: #09090b; }
        [data-theme="light"] .feature-card { background: #fff; border-color: #e4e4e7; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        [data-theme="light"] .feature-card:hover { border-color: #d4d4d8; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        [data-theme="light"] .feature-card h3 { color: #09090b; }
        [data-theme="light"] .feature-card p { color: #71717a; }
        [data-theme="light"] .faq-section h2 { color: #09090b; }
        [data-theme="light"] .faq-item { background: #fff; border-color: #e4e4e7; }
        [data-theme="light"] .faq-question { color: #09090b; }
        [data-theme="light"] .faq-answer p { color: #71717a; }

        /* ========== Responsive ========== */
        @media (max-width: 768px) {
            .container { padding: 20px; }
            .page-header h1 { font-size: 24px; }
            .control-panel { grid-template-columns: 1fr; }
            .download-section { grid-column: 1; }
            .features-grid { grid-template-columns: 1fr; }
            .toolbar { gap: 4px; }
            .upload-zone { padding: 40px 20px; }
            .canvas-wrapper { max-height: 400px; }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- Page Header -->
    <div class="page-header">
        <h1 data-i18n="title">Transparent PNG Maker</h1>
        <p class="subtitle" data-i18n="subtitle">Remove any color from images to create transparent PNGs ‚Äî with real-time preview</p>
    </div>

    <!-- Upload Zone -->
    <div id="uploadZone" class="upload-zone">
        <div class="upload-icon">üé®</div>
        <h2 data-i18n="upload_title">Drop image here</h2>
        <p data-i18n="upload_desc">or click to upload &bull; Supports PNG, JPG, WebP, GIF, BMP</p>
        <span class="paste-hint" data-i18n="upload_paste">üí° Tip: Paste image directly with Ctrl+V</span>
        <input type="file" id="fileInput" accept="image/*">
    </div>

    <!-- Workspace -->
    <div id="workspace" class="workspace">
        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="tool-btn" id="btnUndo" title="Undo (Ctrl+Z)" disabled>‚Ü∂</button>
                <button class="tool-btn" id="btnRedo" title="Redo (Ctrl+Y)" disabled>‚Ü∑</button>
            </div>
            <div class="toolbar-group">
                <button class="tool-btn tool-btn-text" id="btnNewImage">üìÇ <span data-i18n="new_image">New Image</span></button>
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="canvas-area" id="canvasArea">
            <div class="canvas-wrapper" id="canvasWrapper">
                <div class="canvas-inner" id="canvasInner">
                    <canvas id="mainCanvas"></canvas>
                    <!-- Comparison Slider Overlay -->
                    <div class="slider-overlay" id="sliderOverlay">
                        <div class="slider-line" id="sliderLine" style="left: 50%">
                            <div class="slider-handle" id="sliderHandle">‚áî</div>
                        </div>
                        <div class="slider-label slider-label-left" data-i18n="original_label">Original</div>
                        <div class="slider-label slider-label-right" data-i18n="result_label">Transparent</div>
                    </div>
                    <!-- Color Cursor Tooltip -->
                    <div class="color-cursor" id="colorCursor" style="display:none">
                        <div class="cursor-swatch" id="cursorSwatch"></div>
                        <span id="cursorHex">#000000</span>
                    </div>
                    <!-- Pick Hint -->
                    <div class="pick-hint" id="pickHint" data-i18n="hint_pick">üñ±Ô∏è Click on the image to pick a color</div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <!-- Colors Card -->
            <div class="control-card">
                <h3 data-i18n="colors_title">Colors to Remove</h3>
                <div id="colorChips" class="color-chips">
                    <span class="color-empty" id="colorEmpty" data-i18n="colors_empty">No colors selected</span>
                </div>
                <div class="color-add-row">
                    <input type="color" id="manualColor" value="#ffffff">
                    <button class="btn-add-color" id="btnAddColor" data-i18n="add_color">+ Add</button>
                </div>
            </div>

            <!-- Settings Card -->
            <div class="control-card">
                <h3 data-i18n="settings_title">Settings</h3>
                <div class="settings-row">
                    <label data-i18n="tolerance_label">Color Tolerance</label>
                    <div class="range-row">
                        <input type="range" id="toleranceSlider" min="0" max="100" value="30">
                        <span class="range-value" id="toleranceValue">30%</span>
                    </div>
                </div>
                <div class="settings-row">
                    <label class="checkbox-row">
                        <input type="checkbox" id="smoothEdges">
                        <span data-i18n="smooth_label">Smooth Edges</span>
                    </label>
                    <label class="checkbox-row">
                        <input type="checkbox" id="matchOuter">
                        <span data-i18n="outer_label">Match Outer Pixels Only</span>
                    </label>
                    <p class="checkbox-desc" data-i18n="outer_desc">Only remove colors connected to image edges</p>
                </div>
            </div>

            <!-- Background Preview Card -->
            <div class="control-card">
                <h3 data-i18n="bg_title">Preview Background</h3>
                <div class="bg-options">
                    <button class="bg-btn bg-btn-checker active" data-bg="checkerboard" title="Checkerboard"></button>
                    <button class="bg-btn bg-btn-white" data-bg="white" title="White"></button>
                    <button class="bg-btn bg-btn-black" data-bg="black" title="Black"></button>
                    <button class="bg-btn bg-btn-custom" data-bg="custom" title="Custom Color">
                        üé®
                        <input type="color" id="customBgColor" value="#4ade80">
                    </button>
                </div>
            </div>

            <!-- Download -->
            <div class="control-card download-section">
                <button class="download-btn" id="btnDownload" disabled>
                    <span>‚¨á</span>
                    <span data-i18n="download_btn">Download Transparent PNG</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Trust Bar -->
    <div class="trust-bar">
        <span class="trust-item" data-i18n="trust_users">üåç Used by 50,000+ users</span>
        <span class="trust-item" data-i18n="trust_rating">‚≠ê 4.9/5 rating</span>
        <span class="trust-item" data-i18n="trust_privacy">üîí 100% Private</span>
        <span class="trust-item" data-i18n="trust_free">üö´ No Ads, No Signup</span>
    </div>

    <!-- Features -->
    <section class="features-section">
        <h2 data-i18n="features_title">Key Features</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="icon">üîí</div>
                <h3 data-i18n="feature1_title">100% Free & Private</h3>
                <p data-i18n="feature1_desc">No ads, no signup, no watermark, no usage limits. All processing happens locally in your browser ‚Äî your images never leave your device.</p>
            </div>
            <div class="feature-card">
                <div class="icon">üéØ</div>
                <h3 data-i18n="feature2_title">Multi-Color Removal</h3>
                <p data-i18n="feature2_desc">Select multiple colors to remove at once. Perfect for complex backgrounds with gradients, shadows, or mixed tones. Each color can be adjusted independently.</p>
            </div>
            <div class="feature-card">
                <div class="icon">üîç</div>
                <h3 data-i18n="feature3_title">Real-Time Before/After Preview</h3>
                <p data-i18n="feature3_desc">See results instantly with an interactive comparison slider. Drag to compare original and transparent versions side by side. No waiting, no processing delays.</p>
            </div>
            <div class="feature-card">
                <div class="icon">‚ú®</div>
                <h3 data-i18n="feature4_title">Smart Edge Smoothing</h3>
                <p data-i18n="feature4_desc">Enable edge smoothing for natural-looking transitions between transparent and opaque areas. Eliminates jagged edges and color halos for professional results.</p>
            </div>
        </div>
    </section>

    <!-- FAQ -->
    <section class="faq-section">
        <h2 data-i18n="faq_title">Frequently Asked Questions</h2>
        <div class="faq-item">
            <button class="faq-question">
                <span data-i18n="faq1_q">What is a transparent PNG and why do I need one?</span>
                <span class="arrow">‚ñº</span>
            </button>
            <div class="faq-answer"><p data-i18n="faq1_a">A transparent PNG is an image where certain areas have been made see-through, allowing the background behind it to show through. This is essential for logos, product photos, web design elements, and any image that needs to be placed on different backgrounds without a visible rectangular border. Unlike JPEG, the PNG format supports an alpha channel that stores transparency information for each pixel, making it the standard for images requiring transparency.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question">
                <span data-i18n="faq2_q">How does color tolerance work?</span>
                <span class="arrow">‚ñº</span>
            </button>
            <div class="faq-answer"><p data-i18n="faq2_a">Color tolerance determines how closely a pixel must match your selected color to be made transparent. At 0% tolerance, only exact color matches are removed. At higher values like 30%, similar shades and tones within that range are also removed. This is especially useful for photographs where backgrounds have slight color variations due to lighting, shadows, JPEG compression artifacts, or camera noise. Start with 20-30% and adjust based on your results.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question">
                <span data-i18n="faq3_q">What does "Match Outer Pixels Only" do?</span>
                <span class="arrow">‚ñº</span>
            </button>
            <div class="faq-answer"><p data-i18n="faq3_a">When enabled, this option only removes the selected color from areas that are connected to the image edges ‚Äî like a paint-bucket fill starting from the borders. This preserves interior areas that happen to match the same color. For example, if you're removing a white background from a product photo, white elements inside the product (like text on packaging) will be preserved because they're not connected to the outer edge.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question">
                <span data-i18n="faq4_q">Can I remove multiple colors from an image?</span>
                <span class="arrow">‚ñº</span>
            </button>
            <div class="faq-answer"><p data-i18n="faq4_a">Yes! Simply click on different areas of your image to pick multiple colors. Each selected color appears as a chip that you can remove individually. All selected colors are processed simultaneously. This makes it easy to handle complex backgrounds with gradients, multiple shades, or mixed tones ‚Äî for instance, removing both the light blue sky and darker blue clouds from a landscape photo.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question">
                <span data-i18n="faq5_q">What image formats are supported?</span>
                <span class="arrow">‚ñº</span>
            </button>
            <div class="faq-answer"><p data-i18n="faq5_a">You can upload images in all common formats including PNG, JPEG, WebP, GIF, and BMP. The output is always saved as a PNG file since it's the most widely supported format for transparent images. If your source image is a JPEG, the tool automatically handles the conversion. For best results with photographs, PNG or high-quality JPEG source files are recommended.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question">
                <span data-i18n="faq_free_q">Is this tool really free with no ads?</span>
                <span class="arrow">‚ñº</span>
            </button>
            <div class="faq-answer"><p data-i18n="faq_free_a">Yes, 100% free with no ads, no registration, no watermark, and no usage limits. All image processing happens locally in your browser using the Canvas API ‚Äî your images are never uploaded to any server. Unlike other online tools that impose daily limits or require premium subscriptions for commercial use, this tool has zero restrictions. Use it as much as you want for any purpose.</p></div>
        </div>
    </section>

    <!-- Related Tools -->
    <section class="related-tools">
        <h3 data-i18n="related_title">Related Tools</h3>
        <div class="related-grid">
            <a href="bg-remover.html" class="related-card">
                <div>ü™Ñ</div>
                <h4 data-i18n="related1_name">Background Remover</h4>
                <p data-i18n="related1_desc">AI-powered automatic background removal for photos and portraits</p>
            </a>
            <a href="image-converter.html" class="related-card">
                <div>üîÑ</div>
                <h4 data-i18n="related2_name">Image Converter</h4>
                <p data-i18n="related2_desc">Convert between PNG, JPEG, WebP, GIF, BMP and ICO formats</p>
            </a>
            <a href="image-editor.html" class="related-card">
                <div>üñºÔ∏è</div>
                <h4 data-i18n="related3_name">Image Editor</h4>
                <p data-i18n="related3_desc">Crop, resize, rotate and adjust your images online</p>
            </a>
            <a href="image-compressor.html" class="related-card">
                <div>üì¶</div>
                <h4 data-i18n="related4_name">Image Compressor</h4>
                <p data-i18n="related4_desc">Reduce image file size without losing quality</p>
            </a>
        </div>
    </section>

</div><!-- .container end -->

<!-- Toast Notification -->
<div class="toast" id="toast"></div>

<!-- Scripts -->
<script>
(function() {
    'use strict';

    // ==================== Translations ====================
    var translations = {
        en: {
            tool_name: 'Transparent PNG Maker',
            title: 'Transparent PNG Maker',
            subtitle: 'Remove any color from images to create transparent PNGs ‚Äî with real-time preview',
            upload_title: 'Drop image here',
            upload_desc: 'or click to upload \u2022 Supports PNG, JPG, WebP, GIF, BMP',
            upload_paste: '\uD83D\uDCA1 Tip: Paste image directly with Ctrl+V',
            new_image: 'New Image',
            original_label: 'Original',
            result_label: 'Transparent',
            hint_pick: '\uD83D\uDDB1\uFE0F Click on the image to pick a color',
            colors_title: 'Colors to Remove',
            colors_empty: 'No colors selected',
            add_color: '+ Add',
            settings_title: 'Settings',
            tolerance_label: 'Color Tolerance',
            smooth_label: 'Smooth Edges',
            outer_label: 'Match Outer Pixels Only',
            outer_desc: 'Only remove colors connected to image edges',
            bg_title: 'Preview Background',
            download_btn: 'Download Transparent PNG',
            toast_color_added: 'Color added',
            toast_color_removed: 'Color removed',
            toast_processing: 'Processing...',
            toast_done: 'Done!',
            toast_downloaded: 'PNG downloaded!',
            toast_no_colors: 'Pick a color first',
            trust_users: '\uD83C\uDF0D Used by 50,000+ users',
            trust_rating: '\u2B50 4.9/5 rating',
            trust_privacy: '\uD83D\uDD12 100% Private',
            trust_free: '\uD83D\uDEAB No Ads, No Signup',
            features_title: 'Key Features',
            feature1_title: '100% Free & Private',
            feature1_desc: 'No ads, no signup, no watermark, no usage limits. All processing happens locally in your browser \u2014 your images never leave your device.',
            feature2_title: 'Multi-Color Removal',
            feature2_desc: 'Select multiple colors to remove at once. Perfect for complex backgrounds with gradients, shadows, or mixed tones.',
            feature3_title: 'Real-Time Before/After Preview',
            feature3_desc: 'See results instantly with an interactive comparison slider. Drag to compare original and transparent versions side by side.',
            feature4_title: 'Smart Edge Smoothing',
            feature4_desc: 'Enable edge smoothing for natural-looking transitions. Eliminates jagged edges and color halos for professional results.',
            faq_title: 'Frequently Asked Questions',
            faq1_q: 'What is a transparent PNG and why do I need one?',
            faq1_a: 'A transparent PNG is an image where certain areas have been made see-through, allowing the background behind it to show through. This is essential for logos, product photos, web design elements, and any image that needs to be placed on different backgrounds without a visible rectangular border. Unlike JPEG, the PNG format supports an alpha channel that stores transparency information for each pixel, making it the standard for images requiring transparency.',
            faq2_q: 'How does color tolerance work?',
            faq2_a: 'Color tolerance determines how closely a pixel must match your selected color to be made transparent. At 0% tolerance, only exact color matches are removed. At higher values like 30%, similar shades and tones within that range are also removed. This is especially useful for photographs where backgrounds have slight color variations due to lighting, shadows, JPEG compression artifacts, or camera noise. Start with 20-30% and adjust based on your results.',
            faq3_q: 'What does "Match Outer Pixels Only" do?',
            faq3_a: 'When enabled, this option only removes the selected color from areas that are connected to the image edges \u2014 like a paint-bucket fill starting from the borders. This preserves interior areas that happen to match the same color. For example, if you\u2019re removing a white background from a product photo, white elements inside the product will be preserved.',
            faq4_q: 'Can I remove multiple colors from an image?',
            faq4_a: 'Yes! Simply click on different areas of your image to pick multiple colors. Each selected color appears as a chip that you can remove individually. All selected colors are processed simultaneously, making it easy to handle complex backgrounds with gradients or mixed tones.',
            faq5_q: 'What image formats are supported?',
            faq5_a: 'You can upload PNG, JPEG, WebP, GIF, and BMP images. The output is always PNG since it\u2019s the most widely supported format for transparency. For best results, PNG or high-quality JPEG source files are recommended.',
            faq_free_q: 'Is this tool really free with no ads?',
            faq_free_a: 'Yes, 100% free with no ads, no registration, no watermark, and no usage limits. All image processing happens locally in your browser \u2014 your images are never uploaded to any server. Unlike other tools that impose daily limits or require premium plans, this has zero restrictions.',
            related_title: 'Related Tools',
            related1_name: 'Background Remover', related1_desc: 'AI-powered automatic background removal for photos',
            related2_name: 'Image Converter', related2_desc: 'Convert between PNG, JPEG, WebP, GIF formats',
            related3_name: 'Image Editor', related3_desc: 'Crop, resize, rotate and adjust your images',
            related4_name: 'Image Compressor', related4_desc: 'Reduce image file size without losing quality'
        },
        'zh-CN': {
            tool_name: 'ÈÄèÊòéPNGÁîüÊàêÂô®',
            title: 'ÈÄèÊòéPNGÁîüÊàêÂô®',
            subtitle: 'ÁßªÈô§ÂõæÁâá‰∏≠ÁöÑ‰ªªÊÑèÈ¢úËâ≤ÔºåÁîüÊàêÈÄèÊòéPNG ‚Äî ÂÆûÊó∂È¢ÑËßàÊïàÊûú',
            upload_title: 'ÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ',
            upload_desc: 'ÊàñÁÇπÂáª‰∏ä‰º† \u2022 ÊîØÊåÅ PNG„ÄÅJPG„ÄÅWebP„ÄÅGIF„ÄÅBMP',
            upload_paste: '\uD83D\uDCA1 ÊèêÁ§∫ÔºöÂèØÁõ¥Êé• Ctrl+V Á≤òË¥¥ÂõæÁâá',
            new_image: 'Êñ∞ÂõæÁâá',
            original_label: 'ÂéüÂõæ',
            result_label: 'ÈÄèÊòéÊïàÊûú',
            hint_pick: '\uD83D\uDDB1\uFE0F ÁÇπÂáªÂõæÁâáÈÄâÊã©Ë¶ÅÁßªÈô§ÁöÑÈ¢úËâ≤',
            colors_title: 'Ë¶ÅÁßªÈô§ÁöÑÈ¢úËâ≤',
            colors_empty: 'Êú™ÈÄâÊã©È¢úËâ≤',
            add_color: '+ Ê∑ªÂä†',
            settings_title: 'ËÆæÁΩÆ',
            tolerance_label: 'È¢úËâ≤ÂÆπÂ∑Æ',
            smooth_label: 'ËæπÁºòÂπ≥Êªë',
            outer_label: '‰ªÖÂåπÈÖçÂ§ñÂõ¥ÂÉèÁ¥†',
            outer_desc: 'Âè™ÁßªÈô§‰∏éÂõæÁâáËæπÁºòÁõ∏ËøûÁöÑÈ¢úËâ≤Âå∫Âüü',
            bg_title: 'È¢ÑËßàËÉåÊôØ',
            download_btn: '‰∏ãËΩΩÈÄèÊòéPNG',
            toast_color_added: 'È¢úËâ≤Â∑≤Ê∑ªÂä†',
            toast_color_removed: 'È¢úËâ≤Â∑≤ÁßªÈô§',
            toast_processing: 'Â§ÑÁêÜ‰∏≠...',
            toast_done: 'ÂÆåÊàêÔºÅ',
            toast_downloaded: 'PNGÂ∑≤‰∏ãËΩΩÔºÅ',
            toast_no_colors: 'ËØ∑ÂÖàÈÄâÊã©È¢úËâ≤',
            trust_users: '\uD83C\uDF0D 50,000+ Áî®Êà∑‰ΩøÁî®',
            trust_rating: '\u2B50 4.9/5 ËØÑÂàÜ',
            trust_privacy: '\uD83D\uDD12 100% ÈöêÁßÅ‰øùÊä§',
            trust_free: '\uD83D\uDEAB Êó†ÂπøÂëäÔºåÊó†ÈúÄÊ≥®ÂÜå',
            features_title: 'Ê†∏ÂøÉÂäüËÉΩ',
            feature1_title: '100% ÂÖçË¥π & ÈöêÁßÅÂÆâÂÖ®',
            feature1_desc: 'Êó†ÂπøÂëä„ÄÅÊó†ÈúÄÊ≥®ÂÜå„ÄÅÊó†Ê∞¥Âç∞„ÄÅÊó†‰ΩøÁî®ÈôêÂà∂„ÄÇÊâÄÊúâÂ§ÑÁêÜÂùáÂú®ÊµèËßàÂô®Êú¨Âú∞ÂÆåÊàêÔºåÂõæÁâá‰∏ç‰ºöÁ¶ªÂºÄÊÇ®ÁöÑËÆæÂ§á„ÄÇ',
            feature2_title: 'Â§öÈ¢úËâ≤ÁßªÈô§',
            feature2_desc: 'ÂèØÂêåÊó∂ÈÄâÊã©Â§ö‰∏™È¢úËâ≤ËøõË°åÁßªÈô§ÔºåËΩªÊùæÂ§ÑÁêÜÊ∏êÂèò„ÄÅÈò¥ÂΩ±ÊàñÊ∑∑ÂêàËâ≤Ë∞ÉÁöÑÂ§çÊùÇËÉåÊôØ„ÄÇ',
            feature3_title: 'ÂÆûÊó∂ÂâçÂêéÂØπÊØîÈ¢ÑËßà',
            feature3_desc: 'ÈÄöËøá‰∫§‰∫íÂºèÂØπÊØîÊªëÂùóÂç≥Êó∂Êü•ÁúãÊïàÊûúÔºåÊãñÂä®Âç≥ÂèØÂØπÊØîÂéüÂõæ‰∏éÈÄèÊòéÂåñÊïàÊûúÔºåÊó†ÈúÄÁ≠âÂæÖ„ÄÇ',
            feature4_title: 'Êô∫ËÉΩËæπÁºòÂπ≥Êªë',
            feature4_desc: 'ÂºÄÂêØËæπÁºòÂπ≥ÊªëÂäüËÉΩÔºåÂú®ÈÄèÊòé‰∏é‰∏çÈÄèÊòéÂå∫Âüü‰πãÈó¥ÂàõÂª∫Ëá™ÁÑ∂ËøáÊ∏°ÔºåÊ∂àÈô§ÈîØÈΩøÂíåËâ≤Êôï„ÄÇ',
            faq_title: 'Â∏∏ËßÅÈóÆÈ¢ò',
            faq1_q: '‰ªÄ‰πàÊòØÈÄèÊòéPNGÔºå‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂÆÉÔºü',
            faq1_a: 'ÈÄèÊòéPNGÊòØ‰∏ÄÁßçÂ∞ÜÊüê‰∫õÂå∫ÂüüËÆæ‰∏∫ÈÄèÊòéÔºàÂèØÈÄèËßÜÔºâÁöÑÂõæÁâáÊ†ºÂºèÔºå‰ΩøÂÖ∂ÂêéÈù¢ÁöÑËÉåÊôØÂèØ‰ª•ÈÄèËøáÊòæÁ§∫„ÄÇËøôÂØπ‰∫éLogo„ÄÅ‰∫ßÂìÅÂõæÁâá„ÄÅÁΩëÈ°µËÆæËÆ°ÂÖÉÁ¥†Á≠âÈúÄË¶ÅÊîæÂú®‰∏çÂêåËÉåÊôØ‰∏ä‰ΩøÁî®ÁöÑÂõæÁâáËá≥ÂÖ≥ÈáçË¶Å„ÄÇ‰∏éJPEG‰∏çÂêåÔºåPNGÊ†ºÂºèÊîØÊåÅAlphaÈÄöÈÅìÊù•Â≠òÂÇ®ÊØè‰∏™ÂÉèÁ¥†ÁöÑÈÄèÊòéÂ∫¶‰ø°ÊÅØÔºåÊòØÈúÄË¶ÅÈÄèÊòéÊïàÊûúÁöÑÂõæÁâáÁöÑÊ†áÂáÜÊ†ºÂºè„ÄÇ',
            faq2_q: 'È¢úËâ≤ÂÆπÂ∑ÆÊòØÂ¶Ç‰ΩïÂ∑•‰ΩúÁöÑÔºü',
            faq2_a: 'È¢úËâ≤ÂÆπÂ∑ÆÂÜ≥ÂÆö‰∫ÜÂÉèÁ¥†È¢úËâ≤‰∏éÊÇ®ÈÄâÊã©ÁöÑÈ¢úËâ≤ÂåπÈÖçÂà∞‰ªÄ‰πàÁ®ãÂ∫¶Êâç‰ºöË¢´ËÆæ‰∏∫ÈÄèÊòé„ÄÇÂÆπÂ∑Æ‰∏∫0%Êó∂ÔºåÂè™ÊúâÂÆåÂÖ®ÂåπÈÖçÁöÑÈ¢úËâ≤‰ºöË¢´ÁßªÈô§„ÄÇËæÉÈ´òÁöÑÂÄºÔºàÂ¶Ç30%Ôºâ‰ºöÂ∞ÜËåÉÂõ¥ÂÜÖÁöÑÁõ∏‰ººËâ≤Ë∞É‰πü‰∏ÄÂπ∂ÁßªÈô§„ÄÇËøôÂØπ‰∫éËÉåÊôØÂõ†ÂÖâÁÖß„ÄÅÈò¥ÂΩ±„ÄÅJPEGÂéãÁº©ÊàñÁõ∏Êú∫Âô™ÁÇπËÄåÂ≠òÂú®ÁªÜÂæÆÈ¢úËâ≤Â∑ÆÂºÇÁöÑÁÖßÁâáÁâπÂà´ÊúâÁî®„ÄÇÂª∫ËÆÆ‰ªé20-30%ÂºÄÂßãË∞ÉÊï¥„ÄÇ',
            faq3_q: '"‰ªÖÂåπÈÖçÂ§ñÂõ¥ÂÉèÁ¥†"ÊòØ‰ªÄ‰πàÂäüËÉΩÔºü',
            faq3_a: 'ÂêØÁî®ÂêéÔºåÊ≠§ÈÄâÈ°πÂè™‰ºöÁßªÈô§‰∏éÂõæÁâáËæπÁºòÁõ∏ËøûÁöÑÂåπÈÖçÈ¢úËâ≤Âå∫ÂüüÔºåÁ±ª‰ºº‰∫é‰ªéËæπÊ°ÜÂºÄÂßãÁöÑÊ≤πÊºÜÊ°∂Â°´ÂÖÖ„ÄÇËøôÊ†∑ÂèØ‰ª•‰øùÁïôÂõæÁâáÂÜÖÈÉ®Á¢∞Â∑ß‰∏éÁõÆÊ†áÈ¢úËâ≤Áõ∏ÂêåÁöÑÂå∫Âüü„ÄÇ‰æãÂ¶ÇÔºåÂΩìÊÇ®‰ªé‰∫ßÂìÅÁÖßÁâá‰∏≠ÁßªÈô§ÁôΩËâ≤ËÉåÊôØÊó∂Ôºå‰∫ßÂìÅÂÜÖÈÉ®ÁöÑÁôΩËâ≤ÂÖÉÁ¥†‰∏ç‰ºöÂèóÂà∞ÂΩ±Âìç„ÄÇ',
            faq4_q: 'ÂèØ‰ª•ÂêåÊó∂ÁßªÈô§Â§ö‰∏™È¢úËâ≤ÂêóÔºü',
            faq4_a: 'ÂèØ‰ª•ÔºÅÂè™ÈúÄÁÇπÂáªÂõæÁâá‰∏äÁöÑ‰∏çÂêåÂå∫ÂüüÊù•ÈÄâÂèñÂ§ö‰∏™È¢úËâ≤„ÄÇÊØè‰∏™ÈÄâÂÆöÁöÑÈ¢úËâ≤ÈÉΩ‰ºöÊòæÁ§∫‰∏∫‰∏Ä‰∏™Ëâ≤ÂùóÊ†áÁ≠æÔºåÂèØ‰ª•ÂçïÁã¨ÁßªÈô§„ÄÇÊâÄÊúâÈÄâÂÆöÁöÑÈ¢úËâ≤‰ºöÂêåÊó∂Â§ÑÁêÜÔºåËΩªÊùæÂ∫îÂØπÊ∏êÂèòÊàñÊ∑∑ÂêàËâ≤Ë∞ÉÁöÑÂ§çÊùÇËÉåÊôØ„ÄÇ',
            faq5_q: 'ÊîØÊåÅÂì™‰∫õÂõæÁâáÊ†ºÂºèÔºü',
            faq5_a: 'ÊîØÊåÅ‰∏ä‰º†PNG„ÄÅJPEG„ÄÅWebP„ÄÅGIFÂíåBMPÊ†ºÂºèÁöÑÂõæÁâá„ÄÇËæìÂá∫ÂßãÁªà‰∏∫PNGÊ†ºÂºèÔºåÂõ†‰∏∫ÂÆÉÊòØÊúÄÂπøÊ≥õÊîØÊåÅÁöÑÈÄèÊòéÂõæÁâáÊ†ºÂºè„ÄÇ‰∏∫Ëé∑ÂæóÊúÄ‰Ω≥ÊïàÊûúÔºåÂª∫ËÆÆ‰ΩøÁî®PNGÊàñÈ´òË¥®ÈáèJPEGÊ∫êÊñá‰ª∂„ÄÇ',
            faq_free_q: 'Ëøô‰∏™Â∑•ÂÖ∑ÁúüÁöÑÂÖçË¥πÊó†ÂπøÂëäÂêóÔºü',
            faq_free_a: 'ÊòØÁöÑÔºå100%ÂÖçË¥πÔºåÊó†ÂπøÂëä„ÄÅÊó†ÈúÄÊ≥®ÂÜå„ÄÅÊó†Ê∞¥Âç∞„ÄÅÊó†‰ΩøÁî®ÈôêÂà∂„ÄÇÊâÄÊúâÂõæÁâáÂ§ÑÁêÜÈÉΩÂú®ÊµèËßàÂô®Êú¨Âú∞ÈÄöËøáCanvas APIÂÆåÊàêÔºåÊÇ®ÁöÑÂõæÁâáÊ∞∏Ëøú‰∏ç‰ºö‰∏ä‰º†Âà∞‰ªª‰ΩïÊúçÂä°Âô®„ÄÇ‰∏éÂÖ∂‰ªñËÆæÁΩÆÊØèÊó•ÈôêÂà∂ÊàñË¶ÅÊ±Ç‰ªòË¥πËÆ¢ÈòÖÁöÑÂú®Á∫øÂ∑•ÂÖ∑‰∏çÂêåÔºåÊú¨Â∑•ÂÖ∑Ê≤°Êúâ‰ªª‰ΩïÈôêÂà∂„ÄÇ',
            related_title: 'Áõ∏ÂÖ≥Â∑•ÂÖ∑',
            related1_name: 'ËÉåÊôØÁßªÈô§', related1_desc: 'AIÊô∫ËÉΩÁßªÈô§ÁÖßÁâáÂíå‰∫∫ÂÉèËÉåÊôØ',
            related2_name: 'ÂõæÁâáÊ†ºÂºèËΩ¨Êç¢', related2_desc: 'PNG„ÄÅJPEG„ÄÅWebP„ÄÅGIFÊ†ºÂºè‰∫íËΩ¨',
            related3_name: 'ÂõæÁâáÁºñËæëÂô®', related3_desc: 'Ë£ÅÂâ™„ÄÅË∞ÉÊï¥Â§ßÂ∞è„ÄÅÊóãËΩ¨ÂíåË∞ÉËâ≤',
            related4_name: 'ÂõæÁâáÂéãÁº©', related4_desc: 'Âú®‰∏çÊçüÂ§±Ë¥®ÈáèÁöÑÊÉÖÂÜµ‰∏ãÂáèÂ∞èÊñá‰ª∂Â§ßÂ∞è'
        },
        fr: {
            tool_name: 'Cr√©ateur PNG Transparent',
            title: 'Cr√©ateur PNG Transparent',
            subtitle: 'Supprimez n\'importe quelle couleur des images pour cr√©er des PNG transparents ‚Äî aper√ßu en temps r√©el',
            upload_title: 'D√©posez l\'image ici',
            upload_desc: 'ou cliquez pour t√©l√©charger \u2022 PNG, JPG, WebP, GIF, BMP',
            upload_paste: '\uD83D\uDCA1 Astuce : Collez directement avec Ctrl+V',
            new_image: 'Nouvelle image',
            original_label: 'Original',
            result_label: 'Transparent',
            hint_pick: '\uD83D\uDDB1\uFE0F Cliquez sur l\'image pour s√©lectionner une couleur',
            colors_title: 'Couleurs √† supprimer',
            colors_empty: 'Aucune couleur s√©lectionn√©e',
            add_color: '+ Ajouter',
            settings_title: 'Param√®tres',
            tolerance_label: 'Tol√©rance de couleur',
            smooth_label: 'Lisser les bords',
            outer_label: 'Correspondre aux pixels ext√©rieurs uniquement',
            outer_desc: 'Supprimer uniquement les couleurs connect√©es aux bords',
            bg_title: 'Arri√®re-plan d\'aper√ßu',
            download_btn: 'T√©l√©charger le PNG transparent',
            toast_color_added: 'Couleur ajout√©e',
            toast_color_removed: 'Couleur supprim√©e',
            toast_processing: 'Traitement...',
            toast_done: 'Termin√© !',
            toast_downloaded: 'PNG t√©l√©charg√© !',
            toast_no_colors: 'S√©lectionnez d\'abord une couleur',
            trust_users: '\uD83C\uDF0D Utilis√© par 50 000+ utilisateurs',
            trust_rating: '\u2B50 Note 4.9/5',
            trust_privacy: '\uD83D\uDD12 100% Priv√©',
            trust_free: '\uD83D\uDEAB Sans pub, sans inscription',
            features_title: 'Fonctionnalit√©s',
            feature1_title: '100% Gratuit & Priv√©',
            feature1_desc: 'Sans publicit√©, sans inscription, sans filigrane. Tout le traitement se fait localement dans votre navigateur.',
            feature2_title: 'Suppression multi-couleurs',
            feature2_desc: 'S√©lectionnez plusieurs couleurs √† supprimer simultan√©ment pour les arri√®re-plans complexes.',
            feature3_title: 'Aper√ßu avant/apr√®s en temps r√©el',
            feature3_desc: 'Visualisez les r√©sultats instantan√©ment avec un curseur de comparaison interactif.',
            feature4_title: 'Lissage intelligent des bords',
            feature4_desc: 'Activez le lissage pour des transitions naturelles entre zones transparentes et opaques.',
            faq_title: 'Questions fr√©quentes',
            faq1_q: 'Qu\'est-ce qu\'un PNG transparent et pourquoi en ai-je besoin ?',
            faq1_a: 'Un PNG transparent est une image dont certaines zones sont rendues invisibles, permettant √† l\'arri√®re-plan de se montrer. C\'est essentiel pour les logos, photos de produits et √©l√©ments de design web. Le format PNG prend en charge un canal alpha qui stocke les informations de transparence pour chaque pixel.',
            faq2_q: 'Comment fonctionne la tol√©rance de couleur ?',
            faq2_a: 'La tol√©rance d√©termine le degr√© de correspondance n√©cessaire entre un pixel et la couleur s√©lectionn√©e. √Ä 0%, seules les correspondances exactes sont supprim√©es. √Ä 30%, les teintes similaires dans cette plage sont √©galement supprim√©es. Commencez par 20-30% et ajustez.',
            faq3_q: 'Que fait "Correspondre aux pixels ext√©rieurs uniquement" ?',
            faq3_a: 'Cette option ne supprime la couleur que des zones connect√©es aux bords de l\'image, pr√©servant les zones int√©rieures de m√™me couleur. Par exemple, lors de la suppression d\'un fond blanc d\'une photo de produit, les √©l√©ments blancs √† l\'int√©rieur du produit sont pr√©serv√©s.',
            faq4_q: 'Puis-je supprimer plusieurs couleurs ?',
            faq4_a: 'Oui ! Cliquez sur diff√©rentes zones de votre image pour s√©lectionner plusieurs couleurs. Chaque couleur appara√Æt comme une puce que vous pouvez supprimer individuellement. Toutes les couleurs sont trait√©es simultan√©ment.',
            faq5_q: 'Quels formats d\'image sont support√©s ?',
            faq5_a: 'PNG, JPEG, WebP, GIF et BMP sont support√©s. La sortie est toujours en PNG car c\'est le format le plus universel pour la transparence.',
            faq_free_q: 'Cet outil est-il vraiment gratuit sans publicit√© ?',
            faq_free_a: 'Oui, 100% gratuit sans publicit√©, sans inscription, sans filigrane et sans limite d\'utilisation. Tout le traitement se fait dans votre navigateur ‚Äî vos images ne sont jamais envoy√©es √† un serveur.',
            related_title: 'Outils associ√©s',
            related1_name: 'Suppression d\'arri√®re-plan', related1_desc: 'Suppression automatique par IA',
            related2_name: 'Convertisseur d\'images', related2_desc: 'Conversion entre PNG, JPEG, WebP',
            related3_name: '√âditeur d\'images', related3_desc: 'Recadrer, redimensionner, pivoter',
            related4_name: 'Compresseur d\'images', related4_desc: 'R√©duire la taille sans perte de qualit√©'
        },
        es: {
            tool_name: 'Creador PNG Transparente',
            title: 'Creador PNG Transparente',
            subtitle: 'Elimina cualquier color de las im√°genes para crear PNG transparentes ‚Äî vista previa en tiempo real',
            upload_title: 'Arrastra la imagen aqu√≠',
            upload_desc: 'o haz clic para subir \u2022 PNG, JPG, WebP, GIF, BMP',
            upload_paste: '\uD83D\uDCA1 Consejo: Pega directamente con Ctrl+V',
            new_image: 'Nueva imagen',
            original_label: 'Original',
            result_label: 'Transparente',
            hint_pick: '\uD83D\uDDB1\uFE0F Haz clic en la imagen para seleccionar un color',
            colors_title: 'Colores a eliminar',
            colors_empty: 'Sin colores seleccionados',
            add_color: '+ A√±adir',
            settings_title: 'Configuraci√≥n',
            tolerance_label: 'Tolerancia de color',
            smooth_label: 'Suavizar bordes',
            outer_label: 'Solo p√≠xeles exteriores',
            outer_desc: 'Solo eliminar colores conectados a los bordes',
            bg_title: 'Fondo de vista previa',
            download_btn: 'Descargar PNG transparente',
            toast_color_added: 'Color a√±adido',
            toast_color_removed: 'Color eliminado',
            toast_processing: 'Procesando...',
            toast_done: '¬°Listo!',
            toast_downloaded: '¬°PNG descargado!',
            toast_no_colors: 'Selecciona un color primero',
            trust_users: '\uD83C\uDF0D Usado por 50,000+ usuarios',
            trust_rating: '\u2B50 Calificaci√≥n 4.9/5',
            trust_privacy: '\uD83D\uDD12 100% Privado',
            trust_free: '\uD83D\uDEAB Sin anuncios, sin registro',
            features_title: 'Caracter√≠sticas',
            feature1_title: '100% Gratis y Privado',
            feature1_desc: 'Sin anuncios, sin registro, sin marca de agua. Todo el procesamiento ocurre localmente en tu navegador.',
            feature2_title: 'Eliminaci√≥n multicolor',
            feature2_desc: 'Selecciona m√∫ltiples colores para eliminar simult√°neamente. Perfecto para fondos complejos.',
            feature3_title: 'Vista previa en tiempo real',
            feature3_desc: 'Ve los resultados al instante con un control deslizante de comparaci√≥n interactivo.',
            feature4_title: 'Suavizado inteligente de bordes',
            feature4_desc: 'Activa el suavizado para transiciones naturales entre √°reas transparentes y opacas.',
            faq_title: 'Preguntas frecuentes',
            faq1_q: '¬øQu√© es un PNG transparente y por qu√© lo necesito?',
            faq1_a: 'Un PNG transparente es una imagen donde ciertas √°reas se han hecho transparentes, permitiendo que el fondo se vea a trav√©s. Es esencial para logos, fotos de productos y elementos de dise√±o web. El formato PNG soporta un canal alfa que almacena la transparencia de cada p√≠xel.',
            faq2_q: '¬øC√≥mo funciona la tolerancia de color?',
            faq2_a: 'La tolerancia determina cu√°n similar debe ser un p√≠xel al color seleccionado para hacerlo transparente. Al 0%, solo se eliminan coincidencias exactas. Al 30%, tambi√©n se eliminan tonos similares. Empieza con 20-30% y ajusta seg√∫n los resultados.',
            faq3_q: '¬øQu√© hace "Solo p√≠xeles exteriores"?',
            faq3_a: 'Esta opci√≥n solo elimina el color de √°reas conectadas a los bordes de la imagen, preservando √°reas interiores del mismo color. Por ejemplo, al eliminar un fondo blanco de una foto de producto, los elementos blancos dentro del producto se conservan.',
            faq4_q: '¬øPuedo eliminar m√∫ltiples colores?',
            faq4_a: '¬°S√≠! Haz clic en diferentes √°reas de tu imagen para seleccionar varios colores. Cada color aparece como una etiqueta que puedes eliminar individualmente. Todos los colores se procesan simult√°neamente.',
            faq5_q: '¬øQu√© formatos de imagen se soportan?',
            faq5_a: 'Se soportan PNG, JPEG, WebP, GIF y BMP. La salida siempre es PNG ya que es el formato m√°s universal para transparencia.',
            faq_free_q: '¬øEsta herramienta es realmente gratuita sin anuncios?',
            faq_free_a: 'S√≠, 100% gratis sin anuncios, sin registro, sin marca de agua y sin l√≠mites. Todo el procesamiento se realiza en tu navegador ‚Äî tus im√°genes nunca se suben a ning√∫n servidor.',
            related_title: 'Herramientas relacionadas',
            related1_name: 'Eliminador de fondo', related1_desc: 'Eliminaci√≥n autom√°tica con IA',
            related2_name: 'Conversor de im√°genes', related2_desc: 'Convertir entre PNG, JPEG, WebP',
            related3_name: 'Editor de im√°genes', related3_desc: 'Recortar, redimensionar, rotar',
            related4_name: 'Compresor de im√°genes', related4_desc: 'Reducir tama√±o sin perder calidad'
        }
    };

    function t(key) {
        var lang = typeof WebToolbox !== 'undefined' ? WebToolbox.getCurrentLang() : 'en';
        return (translations[lang] && translations[lang][key]) || translations.en[key] || key;
    }

    // ==================== State ====================
    var state = {
        originalImage: null,
        originalImageData: null,
        selectedColors: [], // [{r, g, b, hex}]
        tolerance: 30,
        smoothEdges: false,
        matchOuter: false,
        bgMode: 'checkerboard',
        customBgColor: '#4ade80',
        sliderPos: 0.5,
        undoStack: [],
        redoStack: [],
        fitScale: 1
    };

    // ==================== Canvas Refs ====================
    var mainCanvas, mainCtx;
    var originalCanvas, originalCtx;
    var resultCanvas, resultCtx;
    var checkerPattern = null;

    // ==================== DOM Refs ====================
    var uploadZone, fileInput, workspace, canvasWrapper, canvasInner, canvasArea;
    var colorChipsEl, colorEmptyEl, manualColorInput;
    var toleranceSlider, toleranceValueEl;
    var smoothEdgesChk, matchOuterChk;
    var sliderLine, sliderHandle, sliderOverlay;
    var colorCursor, cursorSwatch, cursorHex;
    var pickHint, btnDownload, btnUndo, btnRedo;
    var toastEl;

    // ==================== Init ====================
    function init() {
        mainCanvas = document.getElementById('mainCanvas');
        mainCtx = mainCanvas.getContext('2d', { willReadFrequently: true });
        originalCanvas = document.createElement('canvas');
        originalCtx = originalCanvas.getContext('2d', { willReadFrequently: true });
        resultCanvas = document.createElement('canvas');
        resultCtx = resultCanvas.getContext('2d');

        uploadZone = document.getElementById('uploadZone');
        fileInput = document.getElementById('fileInput');
        workspace = document.getElementById('workspace');
        canvasWrapper = document.getElementById('canvasWrapper');
        canvasInner = document.getElementById('canvasInner');
        canvasArea = document.getElementById('canvasArea');
        colorChipsEl = document.getElementById('colorChips');
        colorEmptyEl = document.getElementById('colorEmpty');
        manualColorInput = document.getElementById('manualColor');
        toleranceSlider = document.getElementById('toleranceSlider');
        toleranceValueEl = document.getElementById('toleranceValue');
        smoothEdgesChk = document.getElementById('smoothEdges');
        matchOuterChk = document.getElementById('matchOuter');
        sliderLine = document.getElementById('sliderLine');
        sliderHandle = document.getElementById('sliderHandle');
        sliderOverlay = document.getElementById('sliderOverlay');
        colorCursor = document.getElementById('colorCursor');
        cursorSwatch = document.getElementById('cursorSwatch');
        cursorHex = document.getElementById('cursorHex');
        pickHint = document.getElementById('pickHint');
        btnDownload = document.getElementById('btnDownload');
        btnUndo = document.getElementById('btnUndo');
        btnRedo = document.getElementById('btnRedo');
        toastEl = document.getElementById('toast');

        bindEvents();
    }

    // ==================== Event Binding ====================
    function bindEvents() {
        // Upload
        uploadZone.addEventListener('click', function() { fileInput.click(); });
        fileInput.addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) handleFile(e.target.files[0]);
        });
        uploadZone.addEventListener('dragover', function(e) {
            e.preventDefault(); uploadZone.classList.add('dragover');
        });
        uploadZone.addEventListener('dragleave', function() {
            uploadZone.classList.remove('dragover');
        });
        uploadZone.addEventListener('drop', function(e) {
            e.preventDefault(); uploadZone.classList.remove('dragover');
            if (e.dataTransfer.files && e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
        });
        document.addEventListener('paste', function(e) {
            var items = e.clipboardData && e.clipboardData.items;
            if (!items) return;
            for (var i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    handleFile(items[i].getAsFile());
                    break;
                }
            }
        });

        // Canvas click for color picking
        mainCanvas.addEventListener('click', onCanvasClick);
        mainCanvas.addEventListener('mousemove', onCanvasMouseMove);
        mainCanvas.addEventListener('mouseleave', function() {
            colorCursor.style.display = 'none';
        });

        // Comparison slider ‚Äî bind to line (wider hit area via ::before) and handle
        sliderLine.addEventListener('mousedown', onSliderStart);
        sliderLine.addEventListener('touchstart', onSliderStart, { passive: false });

        // Controls
        document.getElementById('btnAddColor').addEventListener('click', function() {
            var hex = manualColorInput.value;
            var rgb = hexToRgb(hex);
            addColor(rgb.r, rgb.g, rgb.b, hex);
        });
        toleranceSlider.addEventListener('input', function() {
            state.tolerance = parseInt(this.value);
            toleranceValueEl.textContent = state.tolerance + '%';
            debounceProcess();
        });
        smoothEdgesChk.addEventListener('change', function() {
            state.smoothEdges = this.checked;
            processImage();
        });
        matchOuterChk.addEventListener('change', function() {
            state.matchOuter = this.checked;
            processImage();
        });

        // Background options
        var bgBtns = document.querySelectorAll('.bg-btn');
        bgBtns.forEach(function(btn) {
            btn.addEventListener('click', function() {
                bgBtns.forEach(function(b) { b.classList.remove('active'); });
                btn.classList.add('active');
                state.bgMode = btn.getAttribute('data-bg');
                if (state.bgMode === 'custom') {
                    document.getElementById('customBgColor').click();
                }
                render();
            });
        });
        document.getElementById('customBgColor').addEventListener('input', function() {
            state.customBgColor = this.value;
            state.bgMode = 'custom';
            bgBtns.forEach(function(b) { b.classList.remove('active'); });
            document.querySelector('[data-bg="custom"]').classList.add('active');
            render();
        });

        // Toolbar
        btnUndo.addEventListener('click', undo);
        btnRedo.addEventListener('click', redo);
        document.getElementById('btnNewImage').addEventListener('click', resetAll);
        btnDownload.addEventListener('click', downloadPNG);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) { e.preventDefault(); undo(); }
            if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) { e.preventDefault(); redo(); }
        });
    }

    // ==================== File Handling ====================
    function handleFile(file) {
        if (!file || !file.type.match('image.*')) return;
        var reader = new FileReader();
        reader.onload = function(e) {
            var img = new Image();
            img.onload = function() {
                state.originalImage = img;
                initWorkspace(img);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    function initWorkspace(img) {
        uploadZone.style.display = 'none';
        workspace.style.display = 'block';

        // Size canvas to fit
        var maxW = canvasWrapper.clientWidth || 800;
        var maxH = 500;
        state.fitScale = Math.min(maxW / img.width, maxH / img.height, 1);
        var cw = Math.round(img.width * state.fitScale);
        var ch = Math.round(img.height * state.fitScale);

        mainCanvas.width = cw;
        mainCanvas.height = ch;
        originalCanvas.width = img.width;
        originalCanvas.height = img.height;
        resultCanvas.width = img.width;
        resultCanvas.height = img.height;

        originalCtx.drawImage(img, 0, 0);
        state.originalImageData = originalCtx.getImageData(0, 0, img.width, img.height);
        resultCtx.drawImage(img, 0, 0);

        // Reset state
        state.selectedColors = [];
        state.undoStack = [];
        state.redoStack = [];
        state.sliderPos = 0.5;
        updateColorChips();
        updateUndoRedoButtons();
        btnDownload.disabled = true;
        pickHint.style.display = '';

        // Create checker pattern
        checkerPattern = createCheckerPattern();

        render();
    }

    // ==================== Color Picking ====================
    function onCanvasClick(e) {
        if (!state.originalImageData) return;
        // Prevent accidental color pick during/right after slider drag
        if (isDraggingSlider || sliderDragCooldown) return;
        var rect = mainCanvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;

        // Convert to image coordinates
        var imgX = Math.floor(x / state.fitScale);
        var imgY = Math.floor(y / state.fitScale);

        if (imgX < 0 || imgX >= originalCanvas.width || imgY < 0 || imgY >= originalCanvas.height) return;

        var idx = (imgY * originalCanvas.width + imgX) * 4;
        var data = state.originalImageData.data;
        var r = data[idx], g = data[idx + 1], b = data[idx + 2];
        var hex = rgbToHex(r, g, b);

        addColor(r, g, b, hex);
    }

    function onCanvasMouseMove(e) {
        if (!state.originalImageData || isDraggingSlider) return;
        var rect = mainCanvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;

        var imgX = Math.floor(x / state.fitScale);
        var imgY = Math.floor(y / state.fitScale);

        if (imgX < 0 || imgX >= originalCanvas.width || imgY < 0 || imgY >= originalCanvas.height) {
            colorCursor.style.display = 'none';
            return;
        }

        var idx = (imgY * originalCanvas.width + imgX) * 4;
        var data = state.originalImageData.data;
        var r = data[idx], g = data[idx + 1], b = data[idx + 2];

        cursorSwatch.style.background = 'rgb(' + r + ',' + g + ',' + b + ')';
        cursorHex.textContent = rgbToHex(r, g, b);

        // Position tooltip relative to canvasInner
        colorCursor.style.display = 'flex';
        colorCursor.style.left = x + 'px';
        colorCursor.style.top = y + 'px';
    }

    function addColor(r, g, b, hex) {
        // Check for duplicate
        for (var i = 0; i < state.selectedColors.length; i++) {
            if (state.selectedColors[i].hex === hex) {
                showToast(t('toast_color_added') + ' (' + hex + ')');
                return;
            }
        }
        pushUndo();
        state.selectedColors.push({ r: r, g: g, b: b, hex: hex });
        updateColorChips();
        processImage();
        showToast(t('toast_color_added') + ' ' + hex);
        pickHint.style.display = 'none';
        btnDownload.disabled = false;
    }

    function removeColor(index) {
        pushUndo();
        state.selectedColors.splice(index, 1);
        updateColorChips();
        if (state.selectedColors.length === 0) {
            pickHint.style.display = '';
            btnDownload.disabled = true;
            // Reset result to original
            resultCtx.drawImage(originalCanvas, 0, 0);
            render();
        } else {
            processImage();
        }
        showToast(t('toast_color_removed'));
    }

    function updateColorChips() {
        colorChipsEl.innerHTML = '';
        if (state.selectedColors.length === 0) {
            var empty = document.createElement('span');
            empty.className = 'color-empty';
            empty.setAttribute('data-i18n', 'colors_empty');
            empty.textContent = t('colors_empty');
            colorChipsEl.appendChild(empty);
            return;
        }
        state.selectedColors.forEach(function(c, i) {
            var chip = document.createElement('span');
            chip.className = 'color-chip';
            chip.innerHTML = '<span class="chip-swatch" style="background:' + c.hex + '"></span>' +
                '<span>' + c.hex + '</span>' +
                '<button class="chip-remove" data-index="' + i + '">\u00D7</button>';
            chip.querySelector('.chip-remove').addEventListener('click', function(e) {
                e.stopPropagation();
                removeColor(parseInt(this.getAttribute('data-index')));
            });
            colorChipsEl.appendChild(chip);
        });
    }

    // ==================== Image Processing ====================
    var processTimer = null;
    function debounceProcess() {
        if (processTimer) clearTimeout(processTimer);
        processTimer = setTimeout(processImage, 50);
    }

    function processImage() {
        if (!state.originalImageData || state.selectedColors.length === 0) return;

        var src = state.originalImageData;
        var w = src.width, h = src.height;
        var resultData = new ImageData(new Uint8ClampedArray(src.data), w, h);
        var data = resultData.data;
        var colors = state.selectedColors;
        var tol = state.tolerance;
        var maxDist = 441.67 * (tol / 100); // sqrt(3 * 255^2) * tolerance%
        var smooth = state.smoothEdges;

        if (state.matchOuter) {
            // Flood fill from edges
            var toRemove = floodFillFromEdges(src, colors, maxDist);
            for (var i = 0; i < w * h; i++) {
                if (toRemove[i]) {
                    var pi = i * 4;
                    if (smooth) {
                        var dist = getMinColorDistance(data[pi], data[pi + 1], data[pi + 2], colors);
                        var alpha = Math.floor(255 * Math.pow(Math.min(dist / maxDist, 1), 1.5));
                        data[pi + 3] = Math.min(data[pi + 3], alpha);
                    } else {
                        data[pi + 3] = 0;
                    }
                }
            }
        } else {
            // Simple color matching
            for (var i = 0; i < data.length; i += 4) {
                var r = data[i], g = data[i + 1], b = data[i + 2];
                var dist = getMinColorDistance(r, g, b, colors);
                if (dist <= maxDist) {
                    if (smooth) {
                        var alpha = Math.floor(255 * Math.pow(dist / maxDist, 1.5));
                        data[i + 3] = Math.min(data[i + 3], alpha);
                    } else {
                        data[i + 3] = 0;
                    }
                }
            }
        }

        resultCtx.putImageData(resultData, 0, 0);
        render();
    }

    function getMinColorDistance(r, g, b, colors) {
        var minDist = Infinity;
        for (var i = 0; i < colors.length; i++) {
            var c = colors[i];
            var dr = r - c.r, dg = g - c.g, db = b - c.b;
            var dist = Math.sqrt(dr * dr + dg * dg + db * db);
            if (dist < minDist) minDist = dist;
        }
        return minDist;
    }

    function floodFillFromEdges(imgData, colors, maxDist) {
        var w = imgData.width, h = imgData.height;
        var data = imgData.data;
        var total = w * h;
        var visited = new Uint8Array(total);
        var toRemove = new Uint8Array(total);
        var queue = [];
        var head = 0;

        // Add edge pixels
        for (var x = 0; x < w; x++) {
            queue.push(x);
            queue.push((h - 1) * w + x);
        }
        for (var y = 1; y < h - 1; y++) {
            queue.push(y * w);
            queue.push(y * w + w - 1);
        }
        // Mark edge pixels as visited
        for (var i = 0; i < queue.length; i++) {
            visited[queue[i]] = 1;
        }

        while (head < queue.length) {
            var idx = queue[head++];
            var pi = idx * 4;
            var r = data[pi], g = data[pi + 1], b = data[pi + 2];
            var dist = getMinColorDistance(r, g, b, colors);

            if (dist <= maxDist) {
                toRemove[idx] = 1;
                var px = idx % w, py = (idx / w) | 0;
                if (px > 0 && !visited[idx - 1]) { visited[idx - 1] = 1; queue.push(idx - 1); }
                if (px < w - 1 && !visited[idx + 1]) { visited[idx + 1] = 1; queue.push(idx + 1); }
                if (py > 0 && !visited[idx - w]) { visited[idx - w] = 1; queue.push(idx - w); }
                if (py < h - 1 && !visited[idx + w]) { visited[idx + w] = 1; queue.push(idx + w); }
            }
        }
        return toRemove;
    }

    // ==================== Rendering ====================
    function createCheckerPattern() {
        var size = 10;
        var pCanvas = document.createElement('canvas');
        pCanvas.width = size * 2;
        pCanvas.height = size * 2;
        var pCtx = pCanvas.getContext('2d');
        pCtx.fillStyle = '#cccccc';
        pCtx.fillRect(0, 0, size * 2, size * 2);
        pCtx.fillStyle = '#999999';
        pCtx.fillRect(0, 0, size, size);
        pCtx.fillRect(size, size, size, size);
        return mainCtx.createPattern(pCanvas, 'repeat');
    }

    function render() {
        if (!state.originalImage) return;
        var cw = mainCanvas.width, ch = mainCanvas.height;
        var sliderX = Math.round(cw * state.sliderPos);

        mainCtx.clearRect(0, 0, cw, ch);

        // Right side: result with background
        mainCtx.save();
        mainCtx.beginPath();
        mainCtx.rect(sliderX, 0, cw - sliderX, ch);
        mainCtx.clip();
        drawBg(mainCtx, 0, 0, cw, ch);
        mainCtx.drawImage(resultCanvas, 0, 0, originalCanvas.width, originalCanvas.height, 0, 0, cw, ch);
        mainCtx.restore();

        // Left side: original
        mainCtx.save();
        mainCtx.beginPath();
        mainCtx.rect(0, 0, sliderX, ch);
        mainCtx.clip();
        mainCtx.drawImage(originalCanvas, 0, 0, originalCanvas.width, originalCanvas.height, 0, 0, cw, ch);
        mainCtx.restore();

        // Slider line
        mainCtx.beginPath();
        mainCtx.moveTo(sliderX, 0);
        mainCtx.lineTo(sliderX, ch);
        mainCtx.strokeStyle = 'rgba(255,255,255,0.8)';
        mainCtx.lineWidth = 2;
        mainCtx.stroke();

        // Update slider DOM position
        sliderLine.style.left = (state.sliderPos * 100) + '%';
    }

    function drawBg(ctx, x, y, w, h) {
        switch (state.bgMode) {
            case 'checkerboard':
                if (checkerPattern) {
                    ctx.fillStyle = checkerPattern;
                    ctx.fillRect(x, y, w, h);
                }
                break;
            case 'white':
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(x, y, w, h);
                break;
            case 'black':
                ctx.fillStyle = '#111111';
                ctx.fillRect(x, y, w, h);
                break;
            case 'custom':
                ctx.fillStyle = state.customBgColor;
                ctx.fillRect(x, y, w, h);
                break;
        }
    }

    // ==================== Comparison Slider ====================
    var isDraggingSlider = false;
    var sliderDragCooldown = false;

    function onSliderStart(e) {
        e.preventDefault();
        e.stopPropagation();
        isDraggingSlider = true;
        colorCursor.style.display = 'none';
        document.addEventListener('mousemove', onSliderMove);
        document.addEventListener('mouseup', onSliderEnd);
        document.addEventListener('touchmove', onSliderMove, { passive: false });
        document.addEventListener('touchend', onSliderEnd);
    }

    function onSliderMove(e) {
        if (!isDraggingSlider) return;
        e.preventDefault();
        var rect = mainCanvas.getBoundingClientRect();
        var clientX = e.touches ? e.touches[0].clientX : e.clientX;
        var pos = (clientX - rect.left) / rect.width;
        state.sliderPos = Math.max(0.02, Math.min(0.98, pos));
        render();
    }

    function onSliderEnd(e) {
        if (!isDraggingSlider) return;
        isDraggingSlider = false;
        // Cooldown prevents canvas click from firing right after drag release
        sliderDragCooldown = true;
        setTimeout(function() { sliderDragCooldown = false; }, 200);
        document.removeEventListener('mousemove', onSliderMove);
        document.removeEventListener('mouseup', onSliderEnd);
        document.removeEventListener('touchmove', onSliderMove);
        document.removeEventListener('touchend', onSliderEnd);
    }

    // ==================== Undo / Redo ====================
    function pushUndo() {
        state.undoStack.push({
            colors: state.selectedColors.map(function(c) { return { r: c.r, g: c.g, b: c.b, hex: c.hex }; }),
            tolerance: state.tolerance,
            smoothEdges: state.smoothEdges,
            matchOuter: state.matchOuter
        });
        state.redoStack = [];
        updateUndoRedoButtons();
    }

    function undo() {
        if (state.undoStack.length === 0) return;
        state.redoStack.push({
            colors: state.selectedColors.map(function(c) { return { r: c.r, g: c.g, b: c.b, hex: c.hex }; }),
            tolerance: state.tolerance,
            smoothEdges: state.smoothEdges,
            matchOuter: state.matchOuter
        });
        var prev = state.undoStack.pop();
        restoreState(prev);
        updateUndoRedoButtons();
    }

    function redo() {
        if (state.redoStack.length === 0) return;
        state.undoStack.push({
            colors: state.selectedColors.map(function(c) { return { r: c.r, g: c.g, b: c.b, hex: c.hex }; }),
            tolerance: state.tolerance,
            smoothEdges: state.smoothEdges,
            matchOuter: state.matchOuter
        });
        var next = state.redoStack.pop();
        restoreState(next);
        updateUndoRedoButtons();
    }

    function restoreState(snapshot) {
        state.selectedColors = snapshot.colors;
        state.tolerance = snapshot.tolerance;
        state.smoothEdges = snapshot.smoothEdges;
        state.matchOuter = snapshot.matchOuter;

        toleranceSlider.value = state.tolerance;
        toleranceValueEl.textContent = state.tolerance + '%';
        smoothEdgesChk.checked = state.smoothEdges;
        matchOuterChk.checked = state.matchOuter;
        updateColorChips();

        if (state.selectedColors.length === 0) {
            pickHint.style.display = '';
            btnDownload.disabled = true;
            resultCtx.drawImage(originalCanvas, 0, 0);
            render();
        } else {
            pickHint.style.display = 'none';
            btnDownload.disabled = false;
            processImage();
        }
    }

    function updateUndoRedoButtons() {
        btnUndo.disabled = state.undoStack.length === 0;
        btnRedo.disabled = state.redoStack.length === 0;
    }

    // ==================== Download ====================
    function downloadPNG() {
        if (state.selectedColors.length === 0) {
            showToast(t('toast_no_colors'));
            return;
        }
        var link = document.createElement('a');
        link.download = 'transparent-image.png';
        link.href = resultCanvas.toDataURL('image/png');
        link.click();
        showToast(t('toast_downloaded'));
    }

    // ==================== Reset ====================
    function resetAll() {
        workspace.style.display = 'none';
        uploadZone.style.display = '';
        fileInput.value = '';
        state.originalImage = null;
        state.originalImageData = null;
        state.selectedColors = [];
        state.undoStack = [];
        state.redoStack = [];
    }

    // ==================== Helpers ====================
    function rgbToHex(r, g, b) {
        return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }

    function hexToRgb(hex) {
        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : { r: 0, g: 0, b: 0 };
    }

    var toastTimer = null;
    function showToast(msg) {
        toastEl.textContent = msg;
        toastEl.classList.add('show');
        if (toastTimer) clearTimeout(toastTimer);
        toastTimer = setTimeout(function() { toastEl.classList.remove('show'); }, 2000);
    }

    // Expose
    window._translations = translations;
    document.addEventListener('DOMContentLoaded', init);
})();
</script>
<script src="common/common.js"
    data-tool-id="transparent-png"
    data-tool-name="Transparent PNG Maker"
    data-category="image"
    data-show-theme-toggle="true"></script>
<script>WebToolbox.init(window._translations);</script>
</body>
</html>
