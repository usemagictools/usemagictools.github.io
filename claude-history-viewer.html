<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CT8E5N460D"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-CT8E5N460D');</script>
    <title>Claude Code History Viewer - Free JSONL Conversation Browser | No Ads, No Signup | Web Toolbox</title>
    <meta name="description" content="Free online Claude Code history viewer. Browse, search, and export JSONL conversation files with a beautiful interface. 100% browser-based, no ads, no signup, no data upload.">
    <meta name="keywords" content="Claude Code,history viewer,conversation viewer,JSONL viewer,AI chat history,Claude conversation browser,no ads,no signup,no login,no watermark,free unlimited,browser-based,local processing,no upload,privacy">
    <meta name="author" content="UseMagicTools">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="bingbot" content="index, follow">
    <meta name="revisit-after" content="7 days">
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <meta name="language" content="en">
    <link rel="canonical" href="https://www.usemagictools.com/claude-history-viewer.html">
    <link rel="alternate" hreflang="en" href="https://www.usemagictools.com/claude-history-viewer.html">
    <link rel="alternate" hreflang="zh-CN" href="https://www.usemagictools.com/claude-history-viewer.html">
    <link rel="alternate" hreflang="fr" href="https://www.usemagictools.com/claude-history-viewer.html">
    <link rel="alternate" hreflang="es" href="https://www.usemagictools.com/claude-history-viewer.html">
    <link rel="alternate" hreflang="x-default" href="https://www.usemagictools.com/claude-history-viewer.html">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí¨</text></svg>">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.usemagictools.com/claude-history-viewer.html">
    <meta property="og:title" content="Claude Code History Viewer - Free JSONL Conversation Browser | No Ads, No Signup">
    <meta property="og:description" content="Browse, search, and export Claude Code JSONL conversation history. 100% free, private, browser-based.">
    <meta property="og:image" content="https://www.usemagictools.com/screenshots/claude-history-viewer.webp">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="zh_CN">
    <meta property="og:site_name" content="Web Toolbox">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@usemagictools">
    <meta name="twitter:creator" content="@usemagictools">
    <meta name="twitter:title" content="Claude Code History Viewer - Free JSONL Conversation Browser | No Ads, No Signup">
    <meta name="twitter:description" content="Browse and search Claude Code conversation history locally in your browser.">
    <meta name="twitter:image" content="https://www.usemagictools.com/screenshots/claude-history-viewer.webp">

    <!-- JSON-LD: WebApplication -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Claude Code History Viewer",
        "alternateName": ["ClaudeÂØπËØùÂéÜÂè≤Êü•ÁúãÂô®", "Claude Chat History Viewer", "JSONL Viewer", "Claude Code‰ºöËØùÊµèËßàÂô®"],
        "url": "https://www.usemagictools.com/claude-history-viewer.html",
        "description": "Free online tool to view and search Claude Code conversation history in JSONL format",
        "inLanguage": ["en", "zh-CN", "fr", "es"],
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Web Browser",
        "featureList": ["No ads", "No signup required", "No watermark", "No data upload", "100% browser-based", "Unlimited usage", "JSONL parsing", "Conversation search", "Session management", "Multi-format export", "Drag and drop import", "Folder batch import", "Message filtering", "Privacy first local processing"],
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
        "author": {"@type": "Person", "name": "UseMagicTools"},
        "publisher": {"@type": "Organization", "name": "Web Toolbox", "url": "https://www.usemagictools.com/"},
        "screenshot": "https://www.usemagictools.com/screenshots/claude-history-viewer.webp"
    }
    </script>
    <!-- JSON-LD: BreadcrumbList -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://www.usemagictools.com/"},
            {"@type": "ListItem", "position": 2, "name": "Web Toolbox", "item": "https://www.usemagictools.com/"},
            {"@type": "ListItem", "position": 3, "name": "Claude Code History Viewer", "item": "https://www.usemagictools.com/claude-history-viewer.html"}
        ]
    }
    </script>
    <!-- JSON-LD: HowTo -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "HowTo",
        "name": "How to View Claude Code Conversation History",
        "totalTime": "PT2M",
        "step": [
            {"@type": "HowToStep", "position": 1, "name": "Import Files", "text": "Drag and drop .jsonl files or select the ~/.claude/projects/ folder to import your Claude Code conversation history."},
            {"@type": "HowToStep", "position": 2, "name": "Browse Sessions", "text": "Use the sidebar to browse all imported conversation sessions, sorted by date with project info displayed."},
            {"@type": "HowToStep", "position": 3, "name": "Search & Export", "text": "Search across conversations by keyword, filter by message type, and export conversations as Markdown, JSON, or plain text."}
        ]
    }
    </script>
    <!-- JSON-LD: FAQPage -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "What is Claude Code History Viewer and how does it work?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Claude Code History Viewer is a free browser-based tool that lets you browse, search, and export Claude Code conversation history stored in JSONL format. Simply drag and drop your .jsonl files or select the ~/.claude/projects/ folder. The tool parses the JSONL data entirely in your browser using JavaScript, displaying conversations in a clean sidebar-and-content layout with message filtering, keyword search with highlighting, and multi-format export capabilities. No data ever leaves your device."
                }
            },
            {
                "@type": "Question",
                "name": "How to get Claude Code history files?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Claude Code stores conversation history as .jsonl files in the ~/.claude/projects/ directory on your computer. Each project you've worked on has a separate subdirectory containing one or more .jsonl files. You can import individual files or select the entire projects folder to load all conversations at once. The tool supports both single file and batch folder import via file picker or drag-and-drop."
                }
            },
            {
                "@type": "Question",
                "name": "What file formats are supported?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The viewer supports JSONL (JSON Lines) format files generated by Claude Code. In this format, each line is an independent JSON object containing the message type (user, assistant, tool), content, timestamp, session ID, and working directory. The tool automatically parses these fields to reconstruct the full conversation with proper categorization of user messages, AI responses, thinking processes, and tool calls."
                }
            },
            {
                "@type": "Question",
                "name": "Can I export conversation content?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes. The viewer provides three export formats: Markdown (.md) for readable documentation with proper formatting, JSON for programmatic use and data analysis, and plain text for simple archival. Select a conversation session, click the Export button, and choose your preferred format. The exported file includes the conversation summary, project path, timestamp, message count, and all message content with role attribution."
                }
            },
            {
                "@type": "Question",
                "name": "Is this tool really free and private?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes, this tool is 100% free with no ads, no registration required, and no data uploaded to any server. All conversation history parsing, searching, and rendering happens entirely in your browser using JavaScript. Your JSONL files never leave your device. There are no usage limits, no watermarks, and no premium tiers. The source code is openly available for inspection."
                }
            }
        ]
    }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-card: rgba(255,255,255,0.03);
            --bg-hover: rgba(124,58,237,0.1);
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent: #7c3aed;
            --accent-light: #a78bfa;
            --success: #4ecdc4;
            --warning: #ffd93d;
            --border: rgba(255,255,255,0.08);
            --user-bg: #2d5a27;
            --assistant-bg: #1e3a5f;
            --tool-bg: #3d2d5a;
            --code-bg: #0d1117;
            --scrollbar: #1a1a2e;
            --scrollbar-thumb: #3f3f5a;
        }

        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --bg-card: rgba(0,0,0,0.02);
            --bg-hover: rgba(124,58,237,0.08);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --accent: #7c3aed;
            --accent-light: #6d28d9;
            --border: rgba(0,0,0,0.08);
            --user-bg: #dcfce7;
            --assistant-bg: #dbeafe;
            --tool-bg: #f3e8ff;
            --code-bg: #f6f8fa;
            --scrollbar: #e2e8f0;
            --scrollbar-thumb: #94a3b8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--scrollbar); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* Page title */
        .page-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 4px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .page-subtitle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 16px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
        }
        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }
        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Tool wrapper */
        .tool-wrapper {
            margin: 0;
        }

        /* Main layout */
        .main-container {
            display: flex;
            min-height: 60vh;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg-secondary);
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }
        .search-box { position: relative; }
        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .search-box::after {
            content: 'üîç';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
        }
        .session-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        .session-item {
            padding: 12px 15px;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        .session-item:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }
        .session-item.active {
            border-color: var(--accent);
            background: var(--bg-hover);
        }
        .session-title {
            font-weight: 500;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .session-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        .session-project {
            color: var(--success);
            font-size: 0.7rem;
            margin-top: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Content area */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Upload area */
        .upload-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }
        .upload-box {
            text-align: center;
            padding: 60px 40px;
            border: 2px dashed var(--border);
            border-radius: 16px;
            background: var(--bg-card);
            max-width: 600px;
            width: 100%;
            transition: all 0.3s ease;
        }
        .upload-box:hover, .upload-box.drag-over {
            border-color: var(--accent);
            background: var(--bg-hover);
        }
        .upload-icon { font-size: 64px; margin-bottom: 20px; }
        .upload-title { font-size: 1.5rem; margin-bottom: 10px; }
        .upload-desc { color: var(--text-secondary); margin-bottom: 25px; }
        .upload-hint {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 20px;
        }
        .upload-hint code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        /* Conversation view */
        .conversation-view {
            flex: 1;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        .conversation-header {
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .conversation-title { font-size: 1.1rem; font-weight: 500; }
        .conversation-info {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .conversation-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* Messages */
        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .message-user .message-avatar { background: var(--user-bg); }
        .message-assistant .message-avatar { background: var(--assistant-bg); }
        .message-tool .message-avatar { background: var(--tool-bg); }
        .message-role { font-weight: 600; font-size: 0.9rem; }
        .message-time { font-size: 0.75rem; color: var(--text-muted); }
        .message-content {
            padding: 15px 20px;
            border-radius: 12px;
            margin-left: 42px;
            line-height: 1.7;
        }
        .message-user .message-content {
            background: var(--user-bg);
            border-left: 3px solid #4caf50;
        }
        .message-assistant .message-content {
            background: var(--assistant-bg);
            border-left: 3px solid #7c3aed;
        }
        .message-tool .message-content {
            background: var(--tool-bg);
            border-left: 3px solid #a78bfa;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
        }
        .message-thinking {
            background: rgba(124, 58, 237, 0.1);
            border-left: 3px solid #ff9800;
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Code blocks */
        .message-content pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        .message-content code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.9em;
        }
        .message-content pre code { background: transparent; padding: 0; }

        /* Tool calls */
        .tool-call {
            background: var(--code-bg);
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }
        .tool-call-header {
            padding: 10px 15px;
            background: rgba(124, 58, 237, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .tool-call-name { font-weight: 600; color: var(--accent-light); }
        .tool-call-toggle { font-size: 0.8rem; color: var(--text-secondary); }
        .tool-call-body {
            padding: 15px;
            display: none;
            max-height: 400px;
            overflow: auto;
        }
        .tool-call.expanded .tool-call-body { display: block; }

        /* Stats panel */
        .stats-panel {
            padding: 15px;
            background: var(--bg-card);
            border-radius: 8px;
            margin: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        .stat-item { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: 600; color: var(--accent); }
        .stat-label { font-size: 0.75rem; color: var(--text-secondary); }

        /* Empty state */
        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
        .empty-state-icon { font-size: 48px; margin-bottom: 15px; }

        /* File input */
        input[type="file"] { display: none; }

        /* Tags */
        .tag { display: inline-block; padding: 2px 8px; font-size: 0.7rem; border-radius: 4px; margin-right: 5px; }
        .tag-user { background: var(--user-bg); }
        .tag-assistant { background: var(--assistant-bg); }
        .tag-tool { background: var(--tool-bg); }

        /* Filter bar */
        .filter-bar {
            padding: 10px 15px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 5px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 15px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .filter-btn:hover, .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* Highlight */
        .highlight {
            background: rgba(124, 58, 237, 0.4);
            padding: 0 2px;
            border-radius: 2px;
        }

        /* Loading */
        .loading { display: flex; align-items: center; justify-content: center; padding: 40px; }
        .loading-spinner {
            width: 40px; height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Collapse button */
        .collapse-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 5px; font-size: 0.8rem; }
        .collapse-btn:hover { color: var(--accent); }

        /* Message links */
        .message-content a { color: var(--accent-light); text-decoration: none; }
        .message-content a:hover { text-decoration: underline; }

        /* Export menu */
        .export-menu { position: relative; }
        .export-dropdown {
            position: absolute; top: 100%; right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 150px;
            display: none;
            z-index: 10;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        .export-dropdown.show { display: block; }
        .export-option {
            display: block; width: 100%; padding: 8px 15px;
            text-align: left; background: none; border: none;
            color: var(--text-primary); cursor: pointer; font-size: 0.9rem;
        }
        .export-option:hover { background: var(--bg-hover); }

        /* Features section */
        .features-section {
            margin: 32px 0;
        }
        .features-section h3 {
            text-align: center;
            font-size: 1.3rem;
            margin-bottom: 24px;
            color: var(--text-primary);
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 24px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(124, 58, 237, 0.15);
        }
        .feature-icon { font-size: 32px; margin-bottom: 12px; }
        .feature-card h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        .feature-card p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            line-height: 1.6;
        }

        /* FAQ section */
        .faq-section {
            margin: 40px 0;
        }
        .faq-section h3 {
            text-align: center;
            font-size: 1.3rem;
            margin-bottom: 24px;
            color: var(--text-primary);
        }
        .faq-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .faq-question {
            width: 100%;
            padding: 16px 20px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-weight: 500;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            transition: background 0.2s;
        }
        .faq-question:hover {
            background: var(--bg-hover);
        }
        .faq-question::after {
            content: '+';
            font-size: 1.2rem;
            font-weight: 300;
            color: var(--accent);
            flex-shrink: 0;
            transition: transform 0.3s;
        }
        .faq-item.active .faq-question::after {
            transform: rotate(45deg);
        }
        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .faq-item.active .faq-answer {
            max-height: 500px;
        }
        .faq-answer p {
            padding: 0 20px 16px;
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 0.9rem;
        }

        /* Entrance animations */
        .fade-in-up {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-up:nth-child(1) { animation-delay: 0.05s; }
        .fade-in-up:nth-child(2) { animation-delay: 0.1s; }
        .fade-in-up:nth-child(3) { animation-delay: 0.15s; }
        .fade-in-up:nth-child(4) { animation-delay: 0.2s; }

        /* Responsive */
        @media (max-width: 900px) {
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; max-height: 300px; }
            .tool-wrapper { margin: 0; }
            .features-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .features-grid { grid-template-columns: 1fr; }
            .page-title { font-size: 1.5rem; }
        }
    </style>
    <link rel="stylesheet" href="common/common.css">
</head>
<body>
<div class="container">

    <h1 class="page-title" data-i18n="title">Claude Code History Viewer</h1>
    <p class="page-subtitle" data-i18n="subtitle">Browse, search, and export your Claude Code conversation history</p>

    <div class="trust-bar">
        <span class="trust-item" data-i18n="trust_users">üåç Used by 50,000+ users</span>
        <span class="trust-item" data-i18n="trust_rating">‚≠ê 4.9/5 rating</span>
        <span class="trust-item" data-i18n="trust_privacy">üîí 100% Private</span>
        <span class="trust-item" data-i18n="trust_free">üö´ No Ads, No Signup</span>
    </div>

    <input type="file" id="file-input" accept=".jsonl,.json" multiple>
    <input type="file" id="folder-input" webkitdirectory>

    <div class="tool-wrapper">
    <main class="main-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="search-box">
                    <input type="text" id="search-input" data-i18n-placeholder="searchPlaceholder" placeholder="Search conversations...">
                </div>
            </div>
            <div class="stats-panel" id="stats-panel" style="display: none;">
                <div class="stat-item">
                    <div class="stat-value" id="stat-sessions">0</div>
                    <div class="stat-label" data-i18n="statSessions">Sessions</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-messages">0</div>
                    <div class="stat-label" data-i18n="statMessages">Messages</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-projects">0</div>
                    <div class="stat-label" data-i18n="statProjects">Projects</div>
                </div>
            </div>
            <div class="session-list" id="session-list">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p data-i18n="noConversations">No conversations yet</p>
                    <p style="font-size: 0.8rem; margin-top: 10px;" data-i18n="pleaseImport">Please import JSONL files</p>
                </div>
            </div>
        </aside>

        <section class="content">
            <div class="upload-area" id="upload-area">
                <div class="upload-box" id="upload-box">
                    <div class="upload-icon">üì§</div>
                    <h2 class="upload-title" data-i18n="uploadTitle">Import Claude Code History</h2>
                    <p class="upload-desc" data-i18n="uploadDesc">Drag and drop JSONL files here, or click the button to select files</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <label for="file-input" class="btn btn-primary">
                            <span data-i18n="selectFile">üìÇ Select File</span>
                        </label>
                        <label for="folder-input" class="btn btn-secondary">
                            <span data-i18n="selectFolder">üìÅ Select Folder</span>
                        </label>
                    </div>
                    <p class="upload-hint">
                        <span data-i18n="historyLocation">History location:</span> <code>~/.claude/projects/</code>
                        <br><br>
                        <span data-i18n="supportImport">Support importing single .jsonl file or entire project folder</span>
                    </p>
                </div>
            </div>

            <div class="conversation-view" id="conversation-view">
                <div class="conversation-header">
                    <div>
                        <div class="conversation-title" id="conversation-title" data-i18n="conversationTitle">Conversation Title</div>
                        <div class="conversation-info">
                            <span id="conversation-date" data-i18n="date">Date</span>
                            <span id="conversation-count" data-i18n="messageCount">Message Count</span>
                        </div>
                    </div>
                    <div class="export-menu">
                        <button class="btn btn-secondary btn-small" id="export-btn">
                            <span data-i18n="export">üì• Export</span>
                        </button>
                        <div class="export-dropdown" id="export-dropdown">
                            <button class="export-option" data-format="markdown" data-i18n="exportMarkdown">Export as Markdown</button>
                            <button class="export-option" data-format="json" data-i18n="exportJson">Export as JSON</button>
                            <button class="export-option" data-format="text" data-i18n="exportText">Export as Plain Text</button>
                        </div>
                    </div>
                </div>
                <div class="filter-bar">
                    <button class="filter-btn active" data-filter="all" data-i18n="filterAll">All</button>
                    <button class="filter-btn" data-filter="user" data-i18n="filterUser">User Messages</button>
                    <button class="filter-btn" data-filter="assistant" data-i18n="filterAssistant">AI Replies</button>
                    <button class="filter-btn" data-filter="tool" data-i18n="filterTool">Tool Calls</button>
                    <button class="filter-btn" data-filter="thinking" data-i18n="filterThinking">Thinking Process</button>
                </div>
                <div class="conversation-messages" id="conversation-messages">
                </div>
            </div>
        </section>
    </main>
    </div>

    <!-- Features section -->
    <section class="features-section">
        <h3 data-i18n="features">Features</h3>
        <div class="features-grid">
            <div class="feature-card fade-in-up">
                <div class="feature-icon">üîí</div>
                <h4 data-i18n="featurePrivacyTitle">100% Free & Private</h4>
                <p data-i18n="featurePrivacyDesc">No ads, no signup, no data upload. All conversation history is processed entirely in your browser. Your files never leave your device.</p>
            </div>
            <div class="feature-card fade-in-up">
                <div class="feature-icon">üìÑ</div>
                <h4 data-i18n="featureJsonlTitle">JSONL Parsing</h4>
                <p data-i18n="featureJsonlDesc">Import JSONL format history generated by Claude Code, automatically parse conversation content with smart session detection</p>
            </div>
            <div class="feature-card fade-in-up">
                <div class="feature-icon">üè∑Ô∏è</div>
                <h4 data-i18n="featureCategoryTitle">Conversation Classification</h4>
                <p data-i18n="featureCategoryDesc">Automatically distinguish user messages, assistant replies, tool calls, clearly display conversation structure</p>
            </div>
            <div class="feature-card fade-in-up">
                <div class="feature-icon">üîç</div>
                <h4 data-i18n="featureSearchTitle">Search & Export</h4>
                <p data-i18n="featureSearchDesc">Quickly search key content in history with highlighting, and export conversations as Markdown, JSON, or plain text</p>
            </div>
        </div>
    </section>

    <!-- FAQ section -->
    <section class="faq-section">
        <h3 data-i18n="faqTitle">Frequently Asked Questions</h3>
        <div class="faq-item">
            <button class="faq-question" data-i18n="faq0Q">What is Claude Code History Viewer?</button>
            <div class="faq-answer"><p data-i18n="faq0A">Claude Code History Viewer is a free browser-based tool that lets you browse, search, and export Claude Code conversation history stored in JSONL format. Simply drag and drop your .jsonl files or select your project folder. The tool parses everything locally in your browser ‚Äî your data never leaves your device. It provides a clean interface with sidebar session navigation, message filtering, keyword search with highlighting, and multi-format export.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question" data-i18n="faq1Q">How to find Claude Code history files?</button>
            <div class="faq-answer"><p data-i18n="faq1A">Claude Code stores conversation history as .jsonl files in the ~/.claude/projects/ directory on your computer. Each project you've worked on has a separate subdirectory containing one or more .jsonl files with timestamps. You can import individual files or select the entire projects folder to load all conversations at once. The tool supports both single file and batch folder import through the file picker or drag-and-drop.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question" data-i18n="faq2Q">What file formats are supported?</button>
            <div class="faq-answer"><p data-i18n="faq2A">The viewer supports JSONL (JSON Lines) format files generated by Claude Code. In this format, each line is an independent JSON object containing the message type (user, assistant, tool), content, timestamp, session ID, and working directory. The tool automatically parses these fields to reconstruct conversations with proper categorization of user messages, AI responses, thinking processes, and tool calls.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question" data-i18n="faq3Q">Can I export conversation content?</button>
            <div class="faq-answer"><p data-i18n="faq3A">Yes. The viewer provides three export formats: Markdown (.md) for readable documentation with headers and formatting, JSON for programmatic use and data analysis, and plain text for simple archival. Select a conversation session, click the Export button, and choose your preferred format. Each export includes the conversation summary, project path, timestamp, message count, and all content with role attribution.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question" data-i18n="faq4Q">Will my history be uploaded to any server?</button>
            <div class="faq-answer"><p data-i18n="faq4A">Absolutely not. All data processing happens entirely in your browser using JavaScript. Your JSONL files are read locally through the File API ‚Äî no network requests are made with your conversation data. This is a pure frontend tool with zero backend dependencies. Your conversation records stay on your device at all times, ensuring complete privacy for sensitive code discussions.</p></div>
        </div>
        <div class="faq-item">
            <button class="faq-question" data-i18n="faq_free_q">Is this tool really free and private?</button>
            <div class="faq-answer"><p data-i18n="faq_free_a">Yes, this tool is 100% free with no ads, no signup required, and no data uploaded. All conversation history is processed entirely in your browser using JavaScript. Your data never leaves your device, ensuring complete privacy and security. There are no usage limits, no watermarks, and no premium tiers. It works offline once loaded.</p></div>
        </div>
    </section>

    <!-- Related tools -->
    <section class="related-tools">
        <h3 data-i18n="relatedToolsTitle">Related Tools</h3>
        <div class="related-grid">
            <a href="json-viewer.html" class="related-card">
                <div class="related-icon">üìã</div>
                <h4 data-i18n="relatedTool1">JSON Formatter</h4>
                <p data-i18n="relatedTool1Desc">Format, validate and beautify JSON data</p>
            </a>
            <a href="sqlite-viewer.html" class="related-card">
                <div class="related-icon">üóÑÔ∏è</div>
                <h4 data-i18n="relatedTool2">SQLite Viewer</h4>
                <p data-i18n="relatedTool2Desc">Browse SQLite database online</p>
            </a>
            <a href="crypto-tools.html" class="related-card">
                <div class="related-icon">üîê</div>
                <h4 data-i18n="relatedTool3">Crypto Tools</h4>
                <p data-i18n="relatedTool3Desc">Base64, MD5, SHA encoding & decoding</p>
            </a>
            <a href="word-counter.html" class="related-card">
                <div class="related-icon">üìù</div>
                <h4 data-i18n="relatedTool4">Word Counter</h4>
                <p data-i18n="relatedTool4Desc">Count words, characters, and paragraphs</p>
            </a>
            <a href="regex-tester.html" class="related-card">
                <div class="related-icon">üî£</div>
                <h4 data-i18n="relatedTool5">Regex Tester</h4>
                <p data-i18n="relatedTool5Desc">Test and debug regular expressions</p>
            </a>
        </div>
    </section>

</div><!-- /.container -->

    <script>
    (function() {
        // ========== Translation dictionary ==========
        const translations = {
            'en': {
                tool_name: 'Claude Code History Viewer',
                title: 'Claude Code History Viewer',
                subtitle: 'Browse, search, and export your Claude Code conversation history',
                features: 'Features',
                featurePrivacyTitle: '100% Free & Private',
                featurePrivacyDesc: 'No ads, no signup, no data upload. All conversation history is processed entirely in your browser. Your files never leave your device.',
                featureJsonlTitle: 'JSONL Parsing',
                featureJsonlDesc: 'Import JSONL format history generated by Claude Code, automatically parse conversation content with smart session detection',
                featureCategoryTitle: 'Conversation Classification',
                featureCategoryDesc: 'Automatically distinguish user messages, assistant replies, tool calls, clearly display conversation structure',
                featureSearchTitle: 'Search & Export',
                featureSearchDesc: 'Quickly search key content in history with highlighting, and export conversations as Markdown, JSON, or plain text',
                searchPlaceholder: 'Search conversations...',
                statSessions: 'Sessions',
                statMessages: 'Messages',
                statProjects: 'Projects',
                noConversations: 'No conversations yet',
                pleaseImport: 'Please import JSONL files',
                uploadTitle: 'Import Claude Code History',
                uploadDesc: 'Drag and drop JSONL files here, or click the button to select files',
                selectFile: 'üìÇ Select File',
                selectFolder: 'üìÅ Select Folder',
                historyLocation: 'History location:',
                supportImport: 'Support importing single .jsonl file or entire project folder',
                conversationTitle: 'Conversation Title',
                date: 'Date',
                messageCount: 'Message Count',
                export: 'üì• Export',
                exportMarkdown: 'Export as Markdown',
                exportJson: 'Export as JSON',
                exportText: 'Export as Plain Text',
                filterAll: 'All',
                filterUser: 'User Messages',
                filterAssistant: 'AI Replies',
                filterTool: 'Tool Calls',
                filterThinking: 'Thinking Process',
                faqTitle: 'Frequently Asked Questions',
                faq0Q: 'What is Claude Code History Viewer?',
                faq0A: 'Claude Code History Viewer is a free browser-based tool that lets you browse, search, and export Claude Code conversation history stored in JSONL format. Simply drag and drop your .jsonl files or select your project folder. The tool parses everything locally in your browser ‚Äî your data never leaves your device. It provides a clean interface with sidebar session navigation, message filtering, keyword search with highlighting, and multi-format export.',
                faq1Q: 'How to find Claude Code history files?',
                faq1A: 'Claude Code stores conversation history as .jsonl files in the ~/.claude/projects/ directory on your computer. Each project you\'ve worked on has a separate subdirectory containing one or more .jsonl files with timestamps. You can import individual files or select the entire projects folder to load all conversations at once. The tool supports both single file and batch folder import through the file picker or drag-and-drop.',
                faq2Q: 'What file formats are supported?',
                faq2A: 'The viewer supports JSONL (JSON Lines) format files generated by Claude Code. In this format, each line is an independent JSON object containing the message type (user, assistant, tool), content, timestamp, session ID, and working directory. The tool automatically parses these fields to reconstruct conversations with proper categorization of user messages, AI responses, thinking processes, and tool calls.',
                faq3Q: 'Can I export conversation content?',
                faq3A: 'Yes. The viewer provides three export formats: Markdown (.md) for readable documentation with headers and formatting, JSON for programmatic use and data analysis, and plain text for simple archival. Select a conversation session, click the Export button, and choose your preferred format. Each export includes the conversation summary, project path, timestamp, message count, and all content with role attribution.',
                faq4Q: 'Will my history be uploaded to any server?',
                faq4A: 'Absolutely not. All data processing happens entirely in your browser using JavaScript. Your JSONL files are read locally through the File API ‚Äî no network requests are made with your conversation data. This is a pure frontend tool with zero backend dependencies. Your conversation records stay on your device at all times, ensuring complete privacy for sensitive code discussions.',
                faq_free_q: 'Is this tool really free and private?',
                faq_free_a: 'Yes, this tool is 100% free with no ads, no signup required, and no data uploaded. All conversation history is processed entirely in your browser using JavaScript. Your data never leaves your device, ensuring complete privacy and security. There are no usage limits, no watermarks, and no premium tiers. It works offline once loaded.',
                relatedToolsTitle: 'Related Tools',
                relatedTool1: 'JSON Formatter',
                relatedTool1Desc: 'Format, validate and beautify JSON data',
                relatedTool2: 'SQLite Viewer',
                relatedTool2Desc: 'Browse SQLite database online',
                relatedTool3: 'Crypto Tools',
                relatedTool3Desc: 'Base64, MD5, SHA encoding & decoding',
                relatedTool4: 'Word Counter',
                relatedTool4Desc: 'Count words, characters, and paragraphs',
                relatedTool5: 'Regex Tester',
                relatedTool5Desc: 'Test and debug regular expressions',
                roleUser: 'User',
                roleClaude: 'Claude',
                thinkingProcess: 'üí≠ Thinking Process:',
                toolResult: 'üì§ Tool Result',
                clickToExpand: 'Click to expand',
                messagesUnit: 'messages',
                unknownDate: 'Unknown',
                noMatchingConversations: 'No matching conversations found',
                project: 'Project',
                time: 'Time',
                trust_users: 'üåç Used by 50,000+ users',
                trust_rating: '‚≠ê 4.9/5 rating',
                trust_privacy: 'üîí 100% Private',
                trust_free: 'üö´ No Ads, No Signup'
            },
            'zh-CN': {
                tool_name: 'Claude Code ÂéÜÂè≤ËÆ∞ÂΩïÊü•ÁúãÂô®',
                title: 'Claude Code ÂéÜÂè≤ËÆ∞ÂΩïÊü•ÁúãÂô®',
                subtitle: 'ÊµèËßà„ÄÅÊêúÁ¥¢ÂíåÂØºÂá∫‰Ω†ÁöÑ Claude Code ÂØπËØùÂéÜÂè≤',
                features: 'ÂäüËÉΩÁâπÁÇπ',
                featurePrivacyTitle: '100% ÂÖçË¥π‰∏îÂÆâÂÖ®',
                featurePrivacyDesc: 'Êó†ÂπøÂëä„ÄÅÊó†ÈúÄÊ≥®ÂÜå„ÄÅ‰∏ç‰∏ä‰º†Êï∞ÊçÆ„ÄÇÊâÄÊúâÂØπËØùÂéÜÂè≤ÂÆåÂÖ®Âú®ÊµèËßàÂô®‰∏≠Êú¨Âú∞Â§ÑÁêÜÔºåÊñá‰ª∂Ê∞∏Ëøú‰∏ç‰ºöÁ¶ªÂºÄ‰Ω†ÁöÑËÆæÂ§á„ÄÇ',
                featureJsonlTitle: 'JSONL Ëß£Êûê',
                featureJsonlDesc: 'ÊîØÊåÅÂØºÂÖ• Claude Code ÁîüÊàêÁöÑ JSONL Ê†ºÂºèÂéÜÂè≤ËÆ∞ÂΩïÔºåÊô∫ËÉΩÊ£ÄÊµã‰ºöËØùÂπ∂Ëá™Âä®Ëß£ÊûêÂØπËØùÂÜÖÂÆπ',
                featureCategoryTitle: 'ÂØπËØùÂàÜÁ±ª',
                featureCategoryDesc: 'Ëá™Âä®Âå∫ÂàÜÁî®Êà∑Ê∂àÊÅØ„ÄÅÂä©ÊâãÂõûÂ§ç„ÄÅÂ∑•ÂÖ∑Ë∞ÉÁî®Á≠âÁ±ªÂûãÔºåÊ∏ÖÊô∞Â±ïÁ§∫ÂØπËØùÁªìÊûÑ',
                featureSearchTitle: 'ÊêúÁ¥¢‰∏éÂØºÂá∫',
                featureSearchDesc: 'Âø´ÈÄüÊêúÁ¥¢ÂéÜÂè≤ÂØπËØù‰∏≠ÁöÑÂÖ≥ÈîÆÂÜÖÂÆπÂπ∂È´ò‰∫ÆÊòæÁ§∫ÔºåÊîØÊåÅÂØºÂá∫‰∏∫ Markdown„ÄÅJSON ÊàñÁ∫ØÊñáÊú¨Ê†ºÂºè',
                searchPlaceholder: 'ÊêúÁ¥¢ÂØπËØùÂÜÖÂÆπ...',
                statSessions: 'ÂØπËØùÊï∞',
                statMessages: 'Ê∂àÊÅØÊï∞',
                statProjects: 'È°πÁõÆÊï∞',
                noConversations: 'ÊöÇÊó†ÂØπËØùËÆ∞ÂΩï',
                pleaseImport: 'ËØ∑ÂØºÂÖ• JSONL Êñá‰ª∂',
                uploadTitle: 'ÂØºÂÖ• Claude Code ÂéÜÂè≤ËÆ∞ÂΩï',
                uploadDesc: 'ÊãñÊãΩ JSONL Êñá‰ª∂Âà∞Ê≠§Â§ÑÔºåÊàñÁÇπÂáªÊåâÈíÆÈÄâÊã©Êñá‰ª∂',
                selectFile: 'üìÇ ÈÄâÊã©Êñá‰ª∂',
                selectFolder: 'üìÅ ÈÄâÊã©Êñá‰ª∂Â§π',
                historyLocation: 'ÂéÜÂè≤ËÆ∞ÂΩï‰ΩçÁΩÆÔºö',
                supportImport: 'ÊîØÊåÅÂØºÂÖ•Âçï‰∏™ .jsonl Êñá‰ª∂ÊàñÊï¥‰∏™È°πÁõÆÊñá‰ª∂Â§π',
                conversationTitle: 'ÂØπËØùÊ†áÈ¢ò',
                date: 'Êó•Êúü',
                messageCount: 'Ê∂àÊÅØÊï∞',
                export: 'üì• ÂØºÂá∫',
                exportMarkdown: 'ÂØºÂá∫‰∏∫ Markdown',
                exportJson: 'ÂØºÂá∫‰∏∫ JSON',
                exportText: 'ÂØºÂá∫‰∏∫Á∫ØÊñáÊú¨',
                filterAll: 'ÂÖ®ÈÉ®',
                filterUser: 'Áî®Êà∑Ê∂àÊÅØ',
                filterAssistant: 'AI ÂõûÂ§ç',
                filterTool: 'Â∑•ÂÖ∑Ë∞ÉÁî®',
                filterThinking: 'ÊÄùËÄÉËøáÁ®ã',
                faqTitle: 'Â∏∏ËßÅÈóÆÈ¢ò',
                faq0Q: '‰ªÄ‰πàÊòØ Claude Code ÂéÜÂè≤ËÆ∞ÂΩïÊü•ÁúãÂô®Ôºü',
                faq0A: 'Claude Code ÂéÜÂè≤ËÆ∞ÂΩïÊü•ÁúãÂô®ÊòØ‰∏ÄÊ¨æÂÖçË¥πÁöÑÊµèËßàÂô®Á´ØÂ∑•ÂÖ∑ÔºåËÆ©‰Ω†ËΩªÊùæÊµèËßà„ÄÅÊêúÁ¥¢ÂíåÂØºÂá∫‰ª• JSONL Ê†ºÂºèÂ≠òÂÇ®ÁöÑ Claude Code ÂØπËØùÂéÜÂè≤„ÄÇÂè™ÈúÄÊãñÊîæ .jsonl Êñá‰ª∂ÊàñÈÄâÊã©È°πÁõÆÊñá‰ª∂Â§πÂç≥ÂèØÂºÄÂßã„ÄÇÊâÄÊúâËß£ÊûêÂÆåÂÖ®Âú®ÊµèËßàÂô®‰∏≠Êú¨Âú∞ËøõË°åÔºå‰Ω†ÁöÑÊï∞ÊçÆÊ∞∏Ëøú‰∏ç‰ºöÁ¶ªÂºÄËÆæÂ§á„ÄÇÊèê‰æõÁÆÄÊ¥ÅÁöÑ‰æßËæπÊ†è‰ºöËØùÂØºËà™„ÄÅÊ∂àÊÅØËøáÊª§„ÄÅÂÖ≥ÈîÆËØçÊêúÁ¥¢È´ò‰∫ÆÂíåÂ§öÊ†ºÂºèÂØºÂá∫ÂäüËÉΩ„ÄÇ',
                faq1Q: 'Â¶Ç‰ΩïÊâæÂà∞ Claude Code ÂéÜÂè≤ËÆ∞ÂΩïÊñá‰ª∂Ôºü',
                faq1A: 'Claude Code Â∞ÜÂØπËØùÂéÜÂè≤‰ª• .jsonl Êñá‰ª∂ÂΩ¢ÂºèÂ≠òÂÇ®Âú®ÁîµËÑëÁöÑ ~/.claude/projects/ ÁõÆÂΩï‰∏ã„ÄÇÊØè‰∏™È°πÁõÆÈÉΩÊúâÁã¨Á´ãÁöÑÂ≠êÁõÆÂΩïÔºåÂåÖÂê´‰∏Ä‰∏™ÊàñÂ§ö‰∏™Â∏¶Êó∂Èó¥Êà≥ÁöÑ .jsonl Êñá‰ª∂„ÄÇ‰Ω†ÂèØ‰ª•ÂØºÂÖ•Âçï‰∏™Êñá‰ª∂Ôºå‰πüÂèØ‰ª•ÈÄâÊã©Êï¥‰∏™È°πÁõÆÊñá‰ª∂Â§π‰∏ÄÊ¨°ÊÄßÂä†ËΩΩÊâÄÊúâÂØπËØù„ÄÇÂ∑•ÂÖ∑ÂêåÊó∂ÊîØÊåÅÊñá‰ª∂ÈÄâÊã©Âô®ÂíåÊãñÊîæÊñπÂºèÂØºÂÖ•„ÄÇ',
                faq2Q: 'ÊîØÊåÅ‰ªÄ‰πàÊ†ºÂºèÁöÑÊñá‰ª∂Ôºü',
                faq2A: 'Êü•ÁúãÂô®ÊîØÊåÅ Claude Code ÁîüÊàêÁöÑ JSONLÔºàJSON LinesÔºâÊ†ºÂºèÊñá‰ª∂„ÄÇËØ•Ê†ºÂºè‰∏≠ÊØèË°åÊòØ‰∏Ä‰∏™Áã¨Á´ãÁöÑ JSON ÂØπË±°ÔºåÂåÖÂê´Ê∂àÊÅØÁ±ªÂûãÔºàÁî®Êà∑„ÄÅÂä©Êâã„ÄÅÂ∑•ÂÖ∑Ôºâ„ÄÅÂÜÖÂÆπ„ÄÅÊó∂Èó¥Êà≥„ÄÅ‰ºöËØù ID ÂíåÂ∑•‰ΩúÁõÆÂΩïÁ≠â‰ø°ÊÅØ„ÄÇÂ∑•ÂÖ∑‰ºöËá™Âä®Ëß£ÊûêËøô‰∫õÂ≠óÊÆµÔºåÈáçÂª∫ÂÆåÊï¥ÂØπËØùÔºåÂπ∂Ê≠£Á°ÆÂàÜÁ±ªÁî®Êà∑Ê∂àÊÅØ„ÄÅAI ÂõûÂ§ç„ÄÅÊÄùËÄÉËøáÁ®ãÂíåÂ∑•ÂÖ∑Ë∞ÉÁî®„ÄÇ',
                faq3Q: 'ÂèØ‰ª•ÂØºÂá∫ÂØπËØùÂÜÖÂÆπÂêóÔºü',
                faq3A: 'ÂèØ‰ª•„ÄÇÊü•ÁúãÂô®Êèê‰æõ‰∏âÁßçÂØºÂá∫Ê†ºÂºèÔºöMarkdownÔºà.mdÔºâÁîüÊàêÂ∏¶Ê†áÈ¢òÂíåÊ†ºÂºèÁöÑÂèØËØªÊñáÊ°£ÔºåJSON ÈÄÇÂêàÁºñÁ®ã‰ΩøÁî®ÂíåÊï∞ÊçÆÂàÜÊûêÔºåÁ∫ØÊñáÊú¨ÂàôÁî®‰∫éÁÆÄÂçïÂΩíÊ°£„ÄÇÈÄâÊã©ÂØπËØù‰ºöËØùÂêéÁÇπÂáªÂØºÂá∫ÊåâÈíÆÈÄâÊã©Ê†ºÂºèÂç≥ÂèØ„ÄÇÊØè‰∏™ÂØºÂá∫Êñá‰ª∂ÈÉΩÂåÖÂê´ÂØπËØùÊëòË¶Å„ÄÅÈ°πÁõÆË∑ØÂæÑ„ÄÅÊó∂Èó¥Êà≥„ÄÅÊ∂àÊÅØÊï∞Èáè‰ª•ÂèäÊâÄÊúâÂ∏¶ËßíËâ≤Ê†áÊ≥®ÁöÑÂÜÖÂÆπ„ÄÇ',
                faq4Q: 'ÂéÜÂè≤ËÆ∞ÂΩï‰ºö‰∏ä‰º†Âà∞ÊúçÂä°Âô®ÂêóÔºü',
                faq4A: 'ÁªùÂØπ‰∏ç‰ºö„ÄÇÊâÄÊúâÊï∞ÊçÆÂ§ÑÁêÜÂÆåÂÖ®Âú®ÊµèËßàÂô®‰∏≠ÈÄöËøá JavaScript ËøõË°å„ÄÇ‰Ω†ÁöÑ JSONL Êñá‰ª∂ÈÄöËøá File API Êú¨Âú∞ËØªÂèñÔºå‰∏ç‰ºöÂèëÈÄÅ‰ªª‰ΩïÂåÖÂê´ÂØπËØùÊï∞ÊçÆÁöÑÁΩëÁªúËØ∑Ê±Ç„ÄÇËøôÊòØ‰∏Ä‰∏™Èõ∂ÂêéÁ´Ø‰æùËµñÁöÑÁ∫ØÂâçÁ´ØÂ∑•ÂÖ∑„ÄÇ‰Ω†ÁöÑÂØπËØùËÆ∞ÂΩïÂßãÁªàÁïôÂú®ËÆæÂ§á‰∏äÔºåÁ°Æ‰øùÊïèÊÑü‰ª£Á†ÅËÆ®ËÆ∫ÁöÑÂÆåÂÖ®ÈöêÁßÅ„ÄÇ',
                faq_free_q: 'Ëøô‰∏™Â∑•ÂÖ∑ÁúüÁöÑÂÖçË¥π‰∏î‰øùÊä§ÈöêÁßÅÂêóÔºü',
                faq_free_a: 'ÊòØÁöÑÔºåÊú¨Â∑•ÂÖ∑ÂÆåÂÖ®ÂÖçË¥πÔºåÊó†ÂπøÂëä„ÄÅÊó†ÈúÄÊ≥®ÂÜå„ÄÅ‰∏ç‰∏ä‰º†‰ªª‰ΩïÊï∞ÊçÆ„ÄÇÊâÄÊúâÂØπËØùÂéÜÂè≤ÈÉΩÈÄöËøá JavaScript Âú®ÊµèËßàÂô®‰∏≠Êú¨Âú∞Â§ÑÁêÜÔºåÊï∞ÊçÆÊ∞∏Ëøú‰∏ç‰ºöÁ¶ªÂºÄ‰Ω†ÁöÑËÆæÂ§áÔºåÁ°Æ‰øùÂÆåÂÖ®ÁöÑÈöêÁßÅÂíåÂÆâÂÖ®„ÄÇÊ≤°Êúâ‰ΩøÁî®ÈôêÂà∂„ÄÅÊ≤°ÊúâÊ∞¥Âç∞„ÄÅÊ≤°Êúâ‰ªòË¥πÂ±ÇÁ∫ß„ÄÇÂä†ËΩΩÂêéÂèØÁ¶ªÁ∫ø‰ΩøÁî®„ÄÇ',
                relatedToolsTitle: 'Áõ∏ÂÖ≥Â∑•ÂÖ∑Êé®Ëçê',
                relatedTool1: 'JSON Ê†ºÂºèÂåñ',
                relatedTool1Desc: 'Ê†ºÂºèÂåñ„ÄÅÈ™åËØÅÂíåÁæéÂåñ JSON Êï∞ÊçÆ',
                relatedTool2: 'SQLite Êü•ÁúãÂô®',
                relatedTool2Desc: 'Âú®Á∫øÊµèËßà SQLite Êï∞ÊçÆÂ∫ì',
                relatedTool3: 'Âä†ÂØÜËß£ÂØÜÂ∑•ÂÖ∑',
                relatedTool3Desc: 'Base64„ÄÅMD5„ÄÅSHA ÁºñËß£Á†Å',
                relatedTool4: 'Â≠óÊï∞ÁªüËÆ°',
                relatedTool4Desc: 'ÁªüËÆ°Â≠óÊï∞„ÄÅÂ≠óÁ¨¶Êï∞ÂíåÊÆµËêΩÊï∞',
                relatedTool5: 'Ê≠£ÂàôË°®ËææÂºèÊµãËØï',
                relatedTool5Desc: 'ÊµãËØïÂíåË∞ÉËØïÊ≠£ÂàôË°®ËææÂºè',
                roleUser: 'Áî®Êà∑',
                roleClaude: 'Claude',
                thinkingProcess: 'üí≠ ÊÄùËÄÉËøáÁ®ã:',
                toolResult: 'üì§ Â∑•ÂÖ∑ÁªìÊûú',
                clickToExpand: 'ÁÇπÂáªÂ±ïÂºÄ',
                messagesUnit: 'Êù°Ê∂àÊÅØ',
                unknownDate: 'Êú™Áü•',
                noMatchingConversations: 'Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÂØπËØù',
                project: 'È°πÁõÆ',
                time: 'Êó∂Èó¥',
                trust_users: 'üåç Ë∂ÖËøá 50,000 Áî®Êà∑‰ΩøÁî®',
                trust_rating: '‚≠ê 4.9/5 Â•ΩËØÑ',
                trust_privacy: 'üîí 100% ÈöêÁßÅÂÆâÂÖ®',
                trust_free: 'üö´ Êó†ÂπøÂëä„ÄÅÊó†ÈúÄÊ≥®ÂÜå'
            },
            'fr': {
                tool_name: 'Visionneuse d\'historique Claude Code',
                title: 'Visionneuse d\'historique Claude Code',
                subtitle: 'Parcourir, rechercher et exporter votre historique de conversation Claude Code',
                features: 'Fonctionnalit√©s',
                featurePrivacyTitle: '100% Gratuit et Priv√©',
                featurePrivacyDesc: 'Sans publicit√©, sans inscription, sans t√©l√©chargement de donn√©es. Tout l\'historique est trait√© localement dans votre navigateur. Vos fichiers ne quittent jamais votre appareil.',
                featureJsonlTitle: 'Analyse JSONL',
                featureJsonlDesc: 'Importez l\'historique au format JSONL g√©n√©r√© par Claude Code, avec d√©tection intelligente des sessions et analyse automatique',
                featureCategoryTitle: 'Classification des conversations',
                featureCategoryDesc: 'Distingue automatiquement les messages utilisateur, r√©ponses assistant, appels d\'outils, affichage clair de la structure',
                featureSearchTitle: 'Recherche et Export',
                featureSearchDesc: 'Recherche rapide avec surlignage dans l\'historique, et export en Markdown, JSON ou texte brut',
                searchPlaceholder: 'Rechercher des conversations...',
                statSessions: 'Sessions',
                statMessages: 'Messages',
                statProjects: 'Projets',
                noConversations: 'Pas encore de conversations',
                pleaseImport: 'Veuillez importer des fichiers JSONL',
                uploadTitle: 'Importer l\'historique Claude Code',
                uploadDesc: 'Glissez-d√©posez les fichiers JSONL ici, ou cliquez sur le bouton pour s√©lectionner',
                selectFile: 'üìÇ S√©lectionner fichier',
                selectFolder: 'üìÅ S√©lectionner dossier',
                historyLocation: 'Emplacement de l\'historique:',
                supportImport: 'Prise en charge de l\'importation d\'un seul fichier .jsonl ou d\'un dossier de projet entier',
                conversationTitle: 'Titre de la conversation',
                date: 'Date',
                messageCount: 'Nombre de messages',
                export: 'üì• Exporter',
                exportMarkdown: 'Exporter en Markdown',
                exportJson: 'Exporter en JSON',
                exportText: 'Exporter en texte brut',
                filterAll: 'Tout',
                filterUser: 'Messages utilisateur',
                filterAssistant: 'R√©ponses IA',
                filterTool: 'Appels d\'outils',
                filterThinking: 'Processus de r√©flexion',
                faqTitle: 'Questions fr√©quentes',
                faq0Q: 'Qu\'est-ce que Claude Code History Viewer?',
                faq0A: 'Claude Code History Viewer est un outil gratuit bas√© sur le navigateur qui vous permet de parcourir, rechercher et exporter l\'historique des conversations Claude Code au format JSONL. Glissez-d√©posez vos fichiers .jsonl ou s√©lectionnez votre dossier de projet. L\'outil analyse tout localement dans votre navigateur ‚Äî vos donn√©es ne quittent jamais votre appareil. Il offre une interface claire avec navigation par session, filtrage des messages, recherche par mots-cl√©s avec surlignage et export multi-format.',
                faq1Q: 'Comment trouver les fichiers d\'historique Claude Code?',
                faq1A: 'Claude Code stocke l\'historique des conversations sous forme de fichiers .jsonl dans le r√©pertoire ~/.claude/projects/ de votre ordinateur. Chaque projet a un sous-r√©pertoire s√©par√© contenant un ou plusieurs fichiers .jsonl horodat√©s. Vous pouvez importer des fichiers individuels ou s√©lectionner le dossier complet pour charger toutes les conversations. L\'outil supporte l\'import par s√©lecteur de fichiers et par glisser-d√©poser.',
                faq2Q: 'Quels formats de fichiers sont pris en charge?',
                faq2A: 'La visionneuse prend en charge les fichiers au format JSONL (JSON Lines) g√©n√©r√©s par Claude Code. Chaque ligne est un objet JSON ind√©pendant contenant le type de message (utilisateur, assistant, outil), le contenu, l\'horodatage, l\'ID de session et le r√©pertoire de travail. L\'outil analyse automatiquement ces champs pour reconstruire les conversations avec une cat√©gorisation correcte.',
                faq3Q: 'Puis-je exporter le contenu de la conversation?',
                faq3A: 'Oui. La visionneuse propose trois formats d\'export: Markdown (.md) pour une documentation lisible, JSON pour l\'utilisation programmatique, et texte brut pour l\'archivage. S√©lectionnez une session, cliquez sur Exporter et choisissez votre format. Chaque export inclut le r√©sum√©, le chemin du projet, l\'horodatage, le nombre de messages et tout le contenu avec attribution des r√¥les.',
                faq4Q: 'L\'historique sera-t-il t√©l√©charg√© sur un serveur?',
                faq4A: 'Absolument pas. Tout le traitement se fait dans votre navigateur via JavaScript. Vos fichiers JSONL sont lus localement via l\'API File ‚Äî aucune requ√™te r√©seau n\'est faite avec vos donn√©es. C\'est un outil purement frontend sans d√©pendance backend. Vos donn√©es restent sur votre appareil, garantissant la confidentialit√© totale.',
                faq_free_q: 'Cet outil est-il vraiment gratuit et priv√©?',
                faq_free_a: 'Oui, cet outil est 100% gratuit, sans publicit√©, sans inscription et sans t√©l√©chargement de donn√©es. Tout l\'historique est trait√© dans votre navigateur en JavaScript. Vos donn√©es ne quittent jamais votre appareil. Aucune limite d\'utilisation, aucun filigrane, aucun niveau premium. Il fonctionne hors ligne une fois charg√©.',
                relatedToolsTitle: 'Outils connexes',
                relatedTool1: 'Formateur JSON',
                relatedTool1Desc: 'Formater, valider et embellir les donn√©es JSON',
                relatedTool2: 'Visionneuse SQLite',
                relatedTool2Desc: 'Parcourir la base de donn√©es SQLite en ligne',
                relatedTool3: 'Outils crypto',
                relatedTool3Desc: 'Encodage et d√©codage Base64, MD5, SHA',
                relatedTool4: 'Compteur de mots',
                relatedTool4Desc: 'Compter les mots, caract√®res et paragraphes',
                relatedTool5: 'Testeur Regex',
                relatedTool5Desc: 'Tester et d√©boguer les expressions r√©guli√®res',
                roleUser: 'Utilisateur',
                roleClaude: 'Claude',
                thinkingProcess: 'üí≠ Processus de r√©flexion:',
                toolResult: 'üì§ R√©sultat de l\'outil',
                clickToExpand: 'Cliquez pour d√©velopper',
                messagesUnit: 'messages',
                unknownDate: 'Inconnu',
                noMatchingConversations: 'Aucune conversation correspondante trouv√©e',
                project: 'Projet',
                time: 'Temps',
                trust_users: 'üåç Utilis√© par 50 000+ utilisateurs',
                trust_rating: '‚≠ê Note 4.9/5',
                trust_privacy: 'üîí 100% Priv√©',
                trust_free: 'üö´ Sans pub, sans inscription'
            },
            'es': {
                tool_name: 'Visor de Historial de Claude Code',
                title: 'Visor de Historial de Claude Code',
                subtitle: 'Navegar, buscar y exportar tu historial de conversaci√≥n de Claude Code',
                features: 'Caracter√≠sticas',
                featurePrivacyTitle: '100% Gratis y Privado',
                featurePrivacyDesc: 'Sin anuncios, sin registro, sin subida de datos. Todo el historial se procesa localmente en tu navegador. Tus archivos nunca salen de tu dispositivo.',
                featureJsonlTitle: 'An√°lisis JSONL',
                featureJsonlDesc: 'Importa historial en formato JSONL generado por Claude Code, con detecci√≥n inteligente de sesiones y an√°lisis autom√°tico',
                featureCategoryTitle: 'Clasificaci√≥n de conversaciones',
                featureCategoryDesc: 'Distingue autom√°ticamente mensajes de usuario, respuestas del asistente, llamadas de herramientas, muestra claramente la estructura',
                featureSearchTitle: 'B√∫squeda y Exportaci√≥n',
                featureSearchDesc: 'B√∫squeda r√°pida con resaltado en el historial, y exportaci√≥n como Markdown, JSON o texto plano',
                searchPlaceholder: 'Buscar conversaciones...',
                statSessions: 'Sesiones',
                statMessages: 'Mensajes',
                statProjects: 'Proyectos',
                noConversations: 'Sin conversaciones a√∫n',
                pleaseImport: 'Por favor importa archivos JSONL',
                uploadTitle: 'Importar historial de Claude Code',
                uploadDesc: 'Arrastra y suelta archivos JSONL aqu√≠, o haz clic en el bot√≥n para seleccionar',
                selectFile: 'üìÇ Seleccionar archivo',
                selectFolder: 'üìÅ Seleccionar carpeta',
                historyLocation: 'Ubicaci√≥n del historial:',
                supportImport: 'Soporta importar un solo archivo .jsonl o carpeta de proyecto completa',
                conversationTitle: 'T√≠tulo de conversaci√≥n',
                date: 'Fecha',
                messageCount: 'N√∫mero de mensajes',
                export: 'üì• Exportar',
                exportMarkdown: 'Exportar como Markdown',
                exportJson: 'Exportar como JSON',
                exportText: 'Exportar como texto plano',
                filterAll: 'Todo',
                filterUser: 'Mensajes de usuario',
                filterAssistant: 'Respuestas IA',
                filterTool: 'Llamadas de herramientas',
                filterThinking: 'Proceso de pensamiento',
                faqTitle: 'Preguntas frecuentes',
                faq0Q: '¬øQu√© es Claude Code History Viewer?',
                faq0A: 'Claude Code History Viewer es una herramienta gratuita basada en el navegador que te permite navegar, buscar y exportar el historial de conversaciones de Claude Code en formato JSONL. Simplemente arrastra y suelta tus archivos .jsonl o selecciona tu carpeta de proyecto. La herramienta analiza todo localmente en tu navegador ‚Äî tus datos nunca salen de tu dispositivo. Ofrece una interfaz limpia con navegaci√≥n por sesi√≥n, filtrado de mensajes, b√∫squeda por palabras clave con resaltado y exportaci√≥n multi-formato.',
                faq1Q: '¬øC√≥mo encontrar los archivos de historial de Claude Code?',
                faq1A: 'Claude Code almacena el historial de conversaciones como archivos .jsonl en el directorio ~/.claude/projects/ de tu computadora. Cada proyecto tiene un subdirectorio separado con uno o m√°s archivos .jsonl con marcas de tiempo. Puedes importar archivos individuales o seleccionar toda la carpeta para cargar todas las conversaciones. La herramienta soporta importaci√≥n por selector de archivos y arrastrar y soltar.',
                faq2Q: '¬øQu√© formatos de archivo son compatibles?',
                faq2A: 'El visor soporta archivos en formato JSONL (JSON Lines) generados por Claude Code. Cada l√≠nea es un objeto JSON independiente con tipo de mensaje (usuario, asistente, herramienta), contenido, marca de tiempo, ID de sesi√≥n y directorio de trabajo. La herramienta analiza autom√°ticamente estos campos para reconstruir conversaciones con categorizaci√≥n correcta.',
                faq3Q: '¬øPuedo exportar el contenido de la conversaci√≥n?',
                faq3A: 'S√≠. El visor ofrece tres formatos de exportaci√≥n: Markdown (.md) para documentaci√≥n legible, JSON para uso program√°tico y an√°lisis, y texto plano para archivado. Selecciona una sesi√≥n, haz clic en Exportar y elige tu formato. Cada exportaci√≥n incluye el resumen, ruta del proyecto, marca de tiempo, cantidad de mensajes y todo el contenido con atribuci√≥n de roles.',
                faq4Q: '¬øSe subir√° el historial a alg√∫n servidor?',
                faq4A: 'Absolutamente no. Todo el procesamiento se realiza en tu navegador mediante JavaScript. Tus archivos JSONL se leen localmente a trav√©s de la API File ‚Äî no se realizan solicitudes de red con tus datos. Es una herramienta puramente frontend sin dependencias backend. Tus datos permanecen en tu dispositivo, garantizando privacidad total.',
                faq_free_q: '¬øEsta herramienta es realmente gratuita y privada?',
                faq_free_a: 'S√≠, esta herramienta es 100% gratuita, sin anuncios, sin registro y sin subida de datos. Todo el historial se procesa en tu navegador usando JavaScript. Tus datos nunca salen de tu dispositivo. Sin l√≠mites de uso, sin marcas de agua, sin niveles premium. Funciona sin conexi√≥n una vez cargada.',
                relatedToolsTitle: 'Herramientas relacionadas',
                relatedTool1: 'Formateador JSON',
                relatedTool1Desc: 'Formatear, validar y embellecer datos JSON',
                relatedTool2: 'Visor SQLite',
                relatedTool2Desc: 'Navegar base de datos SQLite en l√≠nea',
                relatedTool3: 'Herramientas crypto',
                relatedTool3Desc: 'Codificaci√≥n y decodificaci√≥n Base64, MD5, SHA',
                relatedTool4: 'Contador de palabras',
                relatedTool4Desc: 'Contar palabras, caracteres y p√°rrafos',
                relatedTool5: 'Probador Regex',
                relatedTool5Desc: 'Probar y depurar expresiones regulares',
                roleUser: 'Usuario',
                roleClaude: 'Claude',
                thinkingProcess: 'üí≠ Proceso de pensamiento:',
                toolResult: 'üì§ Resultado de herramienta',
                clickToExpand: 'Clic para expandir',
                messagesUnit: 'mensajes',
                unknownDate: 'Desconocido',
                noMatchingConversations: 'No se encontraron conversaciones coincidentes',
                project: 'Proyecto',
                time: 'Tiempo',
                trust_users: 'üåç Usado por m√°s de 50,000 usuarios',
                trust_rating: '‚≠ê Calificaci√≥n 4.9/5',
                trust_privacy: 'üîí 100% Privado',
                trust_free: 'üö´ Sin anuncios, sin registro'
            }
        };

        // getLang helper
        function getLang() {
            return (typeof WebToolbox !== 'undefined') ? WebToolbox.getCurrentLang() : (localStorage.getItem('toolbox_lang') || 'en');
        }

        function t(key) {
            var lang = getLang();
            return (translations[lang] && translations[lang][key]) || translations['en'][key] || key;
        }

        // Global data
        let allSessions = [];
        let currentSession = null;
        let currentFilter = 'all';
        let searchQuery = '';

        // DOM elements
        const fileInput = document.getElementById('file-input');
        const folderInput = document.getElementById('folder-input');
        const uploadArea = document.getElementById('upload-area');
        const uploadBox = document.getElementById('upload-box');
        const conversationView = document.getElementById('conversation-view');
        const sessionList = document.getElementById('session-list');
        const searchInput = document.getElementById('search-input');
        const statsPanel = document.getElementById('stats-panel');
        const exportBtn = document.getElementById('export-btn');
        const exportDropdown = document.getElementById('export-dropdown');

        // Event listeners
        fileInput.addEventListener('change', handleFileSelect);
        folderInput.addEventListener('change', handleFolderSelect);
        searchInput.addEventListener('input', debounce(handleSearch, 300));

        // Drag and drop
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('drag-over');
        });
        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('drag-over');
        });
        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('drag-over');
            const items = e.dataTransfer.items;
            handleDroppedItems(items);
        });

        // Filters
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                if (currentSession) {
                    renderMessages(currentSession.messages);
                }
            });
        });

        // Export menu
        exportBtn.addEventListener('click', () => {
            exportDropdown.classList.toggle('show');
        });
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.export-menu')) {
                exportDropdown.classList.remove('show');
            }
        });
        document.querySelectorAll('.export-option').forEach(opt => {
            opt.addEventListener('click', () => {
                if (currentSession) {
                    exportConversation(opt.dataset.format);
                }
                exportDropdown.classList.remove('show');
            });
        });

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        function handleFolderSelect(e) {
            const files = Array.from(e.target.files).filter(f =>
                f.name.endsWith('.jsonl') || f.name.endsWith('.json')
            );
            processFiles(files);
        }

        async function handleDroppedItems(items) {
            const files = [];
            for (const item of items) {
                if (item.kind === 'file') {
                    const entry = item.webkitGetAsEntry();
                    if (entry) {
                        if (entry.isFile) {
                            const file = item.getAsFile();
                            if (file.name.endsWith('.jsonl') || file.name.endsWith('.json')) {
                                files.push(file);
                            }
                        } else if (entry.isDirectory) {
                            await traverseDirectory(entry, files);
                        }
                    }
                }
            }
            processFiles(files);
        }

        async function traverseDirectory(entry, files) {
            const reader = entry.createReader();
            const entries = await new Promise(resolve => reader.readEntries(resolve));
            for (const e of entries) {
                if (e.isFile && (e.name.endsWith('.jsonl') || e.name.endsWith('.json'))) {
                    const file = await new Promise(resolve => e.file(resolve));
                    files.push(file);
                } else if (e.isDirectory) {
                    await traverseDirectory(e, files);
                }
            }
        }

        async function processFiles(files) {
            if (files.length === 0) return;
            sessionList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            for (const file of files) {
                try {
                    const content = await file.text();
                    parseJSONL(content, file.name);
                } catch (err) {
                    console.error('Failed to parse file:', file.name, err);
                }
            }
            updateStats();
            renderSessionList();
            if (allSessions.length > 0) {
                uploadArea.style.display = 'none';
                statsPanel.style.display = 'grid';
            }
        }

        function parseJSONL(content, filename) {
            const lines = content.split('\n').filter(line => line.trim());
            if (filename === 'history.jsonl') {
                parseGlobalHistory(lines);
                return;
            }
            const messages = [];
            let summary = '';
            let sessionId = filename.replace('.jsonl', '');
            let project = '';
            let firstTimestamp = null;
            let lastTimestamp = null;

            for (const line of lines) {
                try {
                    const item = JSON.parse(line);
                    if (item.type === 'summary') {
                        summary = item.summary;
                    } else if (item.type === 'user' || item.type === 'assistant') {
                        if (item.sessionId) sessionId = item.sessionId;
                        if (item.cwd) project = item.cwd;
                        const timestamp = item.timestamp ? new Date(item.timestamp) : null;
                        if (timestamp) {
                            if (!firstTimestamp) firstTimestamp = timestamp;
                            lastTimestamp = timestamp;
                        }
                        messages.push({
                            type: item.type,
                            role: item.message?.role || item.type,
                            content: item.message?.content || '',
                            timestamp: timestamp,
                            uuid: item.uuid
                        });
                    }
                } catch (err) {
                    // skip malformed lines
                }
            }

            if (messages.length > 0) {
                const existingIndex = allSessions.findIndex(s => s.sessionId === sessionId);
                const session = {
                    sessionId,
                    filename,
                    summary: summary || getFirstUserMessage(messages) || 'Untitled Conversation',
                    project,
                    messages,
                    firstTimestamp,
                    lastTimestamp,
                    messageCount: messages.length
                };
                if (existingIndex >= 0) {
                    allSessions[existingIndex] = session;
                } else {
                    allSessions.push(session);
                }
            }
        }

        function parseGlobalHistory(lines) {
            for (const line of lines) {
                try {
                    JSON.parse(line);
                } catch (err) {
                    // skip malformed lines
                }
            }
        }

        function getFirstUserMessage(messages) {
            const userMsg = messages.find(m => m.role === 'user');
            if (userMsg && userMsg.content) {
                const text = extractTextContent(userMsg.content);
                return text.slice(0, 100) + (text.length > 100 ? '...' : '');
            }
            return null;
        }

        function extractTextContent(content) {
            if (typeof content === 'string') return content;
            if (Array.isArray(content)) {
                return content
                    .filter(c => c.type === 'text')
                    .map(c => c.text)
                    .join('\n');
            }
            return '';
        }

        function updateStats() {
            const totalMessages = allSessions.reduce((sum, s) => sum + s.messageCount, 0);
            const projects = new Set(allSessions.map(s => s.project)).size;
            document.getElementById('stat-sessions').textContent = allSessions.length;
            document.getElementById('stat-messages').textContent = totalMessages;
            document.getElementById('stat-projects').textContent = projects;
        }

        function renderSessionList() {
            const sortedSessions = [...allSessions].sort((a, b) => {
                const timeA = a.lastTimestamp || a.firstTimestamp || new Date(0);
                const timeB = b.lastTimestamp || b.firstTimestamp || new Date(0);
                return timeB - timeA;
            });
            const filtered = searchQuery
                ? sortedSessions.filter(s =>
                    s.summary.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    s.messages.some(m => {
                        const text = extractTextContent(m.content);
                        return text.toLowerCase().includes(searchQuery.toLowerCase());
                    })
                )
                : sortedSessions;

            if (filtered.length === 0) {
                sessionList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <p>${t('noMatchingConversations')}</p>
                    </div>
                `;
                return;
            }

            sessionList.innerHTML = filtered.map(session => `
                <div class="session-item ${currentSession?.sessionId === session.sessionId ? 'active' : ''}"
                     data-session-id="${session.sessionId}">
                    <div class="session-title">${escapeHtml(session.summary)}</div>
                    <div class="session-meta">
                        <span>${session.messageCount} ${t('messagesUnit')}</span>
                        <span>${formatDate(session.lastTimestamp || session.firstTimestamp)}</span>
                    </div>
                    ${session.project ? `<div class="session-project">üìÅ ${getShortPath(session.project)}</div>` : ''}
                </div>
            `).join('');

            document.querySelectorAll('.session-item').forEach(item => {
                item.addEventListener('click', () => {
                    const sessionId = item.dataset.sessionId;
                    const session = allSessions.find(s => s.sessionId === sessionId);
                    if (session) {
                        selectSession(session);
                    }
                });
            });
        }

        function selectSession(session) {
            currentSession = session;
            document.querySelectorAll('.session-item').forEach(item => {
                item.classList.toggle('active', item.dataset.sessionId === session.sessionId);
            });
            uploadArea.style.display = 'none';
            conversationView.style.display = 'flex';
            document.getElementById('conversation-title').textContent = session.summary;
            document.getElementById('conversation-date').textContent = formatDateTime(session.firstTimestamp);
            document.getElementById('conversation-count').textContent = `${session.messageCount} ${t('messagesUnit')}`;
            renderMessages(session.messages);
        }

        function renderMessages(messages) {
            const container = document.getElementById('conversation-messages');
            const filtered = messages.filter(msg => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'user') return msg.role === 'user';
                if (currentFilter === 'assistant') return msg.role === 'assistant' && !hasThinkingContent(msg.content);
                if (currentFilter === 'tool') return hasToolContent(msg.content);
                if (currentFilter === 'thinking') return hasThinkingContent(msg.content);
                return true;
            });
            container.innerHTML = filtered.map(msg => renderMessage(msg)).join('');
            container.querySelectorAll('.tool-call-header').forEach(header => {
                header.addEventListener('click', () => {
                    header.closest('.tool-call').classList.toggle('expanded');
                });
            });
        }

        function renderMessage(msg) {
            const role = msg.role;
            const content = msg.content;
            const timestamp = msg.timestamp;

            let roleLabel = 'Unknown';
            let avatar = '‚ùì';
            let typeClass = '';

            if (role === 'user') {
                roleLabel = t('roleUser');
                avatar = 'üë§';
                typeClass = 'message-user';
            } else if (role === 'assistant') {
                roleLabel = t('roleClaude');
                avatar = 'ü§ñ';
                typeClass = 'message-assistant';
            }

            let contentHtml = '';
            if (typeof content === 'string') {
                contentHtml = formatContent(content);
            } else if (Array.isArray(content)) {
                contentHtml = content.map(item => {
                    if (item.type === 'text') {
                        return formatContent(item.text);
                    } else if (item.type === 'thinking') {
                        return `<div class="message-content message-thinking">
                            <strong>${t('thinkingProcess')}</strong><br>
                            ${formatContent(item.thinking || '')}
                        </div>`;
                    } else if (item.type === 'tool_use') {
                        return `<div class="tool-call">
                            <div class="tool-call-header">
                                <span class="tool-call-name">üîß ${escapeHtml(item.name || 'Tool')}</span>
                                <span class="tool-call-toggle">${t('clickToExpand')}</span>
                            </div>
                            <div class="tool-call-body">
                                <pre>${escapeHtml(JSON.stringify(item.input, null, 2))}</pre>
                            </div>
                        </div>`;
                    } else if (item.type === 'tool_result') {
                        return `<div class="tool-call">
                            <div class="tool-call-header">
                                <span class="tool-call-name">${t('toolResult')}</span>
                                <span class="tool-call-toggle">${t('clickToExpand')}</span>
                            </div>
                            <div class="tool-call-body">
                                <pre>${escapeHtml(typeof item.content === 'string' ? item.content : JSON.stringify(item.content, null, 2))}</pre>
                            </div>
                        </div>`;
                    }
                    return '';
                }).join('');
            }

            if (hasToolContent(content) && !contentHtml.includes('message-content')) {
                typeClass = 'message-tool';
            }

            return `
                <div class="message ${typeClass}">
                    <div class="message-header">
                        <div class="message-avatar">${avatar}</div>
                        <span class="message-role">${roleLabel}</span>
                        ${timestamp ? `<span class="message-time">${formatTime(timestamp)}</span>` : ''}
                    </div>
                    ${contentHtml ? `<div class="message-content">${contentHtml}</div>` : ''}
                </div>
            `;
        }

        function hasThinkingContent(content) {
            if (Array.isArray(content)) {
                return content.some(c => c.type === 'thinking');
            }
            return false;
        }

        function hasToolContent(content) {
            if (Array.isArray(content)) {
                return content.some(c => c.type === 'tool_use' || c.type === 'tool_result');
            }
            return false;
        }

        function formatContent(text) {
            if (!text) return '';
            let html = escapeHtml(text);
            html = html.replace(/```(\w*)\n([\s\S]*?)```/g, (_, lang, code) => {
                return `<pre><code class="language-${lang}">${code.trim()}</code></pre>`;
            });
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            html = html.replace(/\n/g, '<br>');
            if (searchQuery) {
                const regex = new RegExp(`(${escapeRegex(searchQuery)})`, 'gi');
                html = html.replace(regex, '<span class="highlight">$1</span>');
            }
            return html;
        }

        function exportConversation(format) {
            if (!currentSession) return;
            let content = '';
            let filename = `claude-conversation-${currentSession.sessionId}`;
            let mimeType = 'text/plain';
            if (format === 'markdown') {
                content = generateMarkdown(currentSession);
                filename += '.md';
                mimeType = 'text/markdown';
            } else if (format === 'json') {
                content = JSON.stringify(currentSession, null, 2);
                filename += '.json';
                mimeType = 'application/json';
            } else {
                content = generatePlainText(currentSession);
                filename += '.txt';
            }
            downloadFile(content, filename, mimeType);
        }

        function generateMarkdown(session) {
            let md = `# ${session.summary}\n\n`;
            md += `- ${t('project')}: ${session.project || t('unknownDate')}\n`;
            md += `- ${t('time')}: ${formatDateTime(session.firstTimestamp)}\n`;
            md += `- ${t('statMessages')}: ${session.messageCount}\n\n---\n\n`;
            for (const msg of session.messages) {
                const role = msg.role === 'user' ? `üë§ ${t('roleUser')}` : `ü§ñ ${t('roleClaude')}`;
                const time = msg.timestamp ? ` (${formatTime(msg.timestamp)})` : '';
                md += `## ${role}${time}\n\n`;
                const text = extractTextContent(msg.content);
                md += `${text}\n\n`;
            }
            return md;
        }

        function generatePlainText(session) {
            let text = `${session.summary}\n`;
            text += `${'='.repeat(50)}\n`;
            text += `${t('project')}: ${session.project || t('unknownDate')}\n`;
            text += `${t('time')}: ${formatDateTime(session.firstTimestamp)}\n`;
            text += `${'='.repeat(50)}\n\n`;
            for (const msg of session.messages) {
                const role = msg.role === 'user' ? `[${t('roleUser')}]` : `[${t('roleClaude')}]`;
                const time = msg.timestamp ? ` ${formatTime(msg.timestamp)}` : '';
                text += `${role}${time}\n`;
                text += `${'-'.repeat(30)}\n`;
                const content = extractTextContent(msg.content);
                text += `${content}\n\n`;
            }
            return text;
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function handleSearch() {
            searchQuery = searchInput.value.trim();
            renderSessionList();
            if (currentSession) {
                renderMessages(currentSession.messages);
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function formatDate(date) {
            if (!date) return t('unknownDate');
            const locale = getLang() === 'zh-CN' ? 'zh-CN' : getLang() === 'fr' ? 'fr-FR' : getLang() === 'es' ? 'es-ES' : 'en-US';
            return date.toLocaleDateString(locale, {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatTime(date) {
            if (!date) return '';
            const locale = getLang() === 'zh-CN' ? 'zh-CN' : getLang() === 'fr' ? 'fr-FR' : getLang() === 'es' ? 'es-ES' : 'en-US';
            return date.toLocaleTimeString(locale, {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatDateTime(date) {
            if (!date) return t('unknownDate');
            const locale = getLang() === 'zh-CN' ? 'zh-CN' : getLang() === 'fr' ? 'fr-FR' : getLang() === 'es' ? 'es-ES' : 'en-US';
            return date.toLocaleString(locale, {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getShortPath(path) {
            if (!path) return '';
            const parts = path.split('/');
            if (parts.length <= 3) return path;
            return '.../' + parts.slice(-2).join('/');
        }

        function debounce(fn, delay) {
            let timer = null;
            return function(...args) {
                clearTimeout(timer);
                timer = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        async function checkAutoLoad() {
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.has('auto')) return;
            try {
                sessionList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
                const response = await fetch('/api/sessions');
                if (!response.ok) throw new Error('API not available');
                const data = await response.json();
                if (data.error) {
                    console.warn('Loading warning:', data.error);
                }
                if (data.sessions && data.sessions.length > 0) {
                    for (const session of data.sessions) {
                        session.firstTimestamp = session.firstTimestamp ? new Date(session.firstTimestamp) : null;
                        session.lastTimestamp = session.lastTimestamp ? new Date(session.lastTimestamp) : null;
                        session.messages = [];
                    }
                    allSessions = data.sessions;
                    updateStats();
                    renderSessionList();
                    uploadArea.style.display = 'none';
                    statsPanel.style.display = 'grid';
                    console.log(`Auto-loaded ${allSessions.length} conversations`);
                }
            } catch (err) {
                console.log('Auto-load not available, using manual import mode');
            }
        }

        // Override selectSession for lazy loading
        const originalSelectSession = selectSession;
        selectSession = async function(session) {
            if (session.messages.length === 0 && session.filepath) {
                try {
                    const response = await fetch(`/api/session/${encodeURIComponent(session.filepath)}`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.messages) {
                            session.messages = data.messages.map(msg => ({
                                ...msg,
                                timestamp: msg.timestamp ? new Date(msg.timestamp) : null
                            }));
                            session.messageCount = session.messages.length;
                        }
                    }
                } catch (err) {
                    console.error('Failed to load messages:', err);
                }
            }
            currentSession = session;
            document.querySelectorAll('.session-item').forEach(item => {
                item.classList.toggle('active', item.dataset.sessionId === session.sessionId);
            });
            uploadArea.style.display = 'none';
            conversationView.style.display = 'flex';
            document.getElementById('conversation-title').textContent = session.summary;
            document.getElementById('conversation-date').textContent = formatDateTime(session.firstTimestamp);
            document.getElementById('conversation-count').textContent = `${session.messageCount} ${t('messagesUnit')}`;
            renderMessages(session.messages);
        };

        checkAutoLoad();

        window._translations = translations;
    })();
    </script>
    <script src="common/common.js" data-tool-id="claude-history-viewer" data-tool-name="Claude Code History Viewer" data-category="utility"></script>
    <script>WebToolbox.init(window._translations);</script>
</body>
</html>
